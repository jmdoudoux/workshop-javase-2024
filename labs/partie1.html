<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="author" content="Par Clément de Tastes et J.M. Doudoux">
<link rel="icon" type="image/x-icon" href="favicon.ico">
<title>Workshop Java SE en 2024</title>
<link rel="stylesheet" href="./styles/styles.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="./styles/rouge-github.css">
<script src="script/clipboard.min.js"></script>
<style>
    .listingblock:hover .clipboard {
        display: block;
    }

    .clipboard {
        display: none;
        border: 0;
        font-size: .75em;
        text-transform: uppercase;
        font-weight: 500;
        padding: 6px;
        color: #999;
        position: absolute;
        top: .425rem;
        right: .5rem;
        background: transparent;
    }

    code + .clipboard {
        top: 2rem !important;
    }

    .clipboard:hover, .clipboard:focus, .clipboard:active {
        outline: 0;
        background-color: #eee9e6;
    }
</style>
<script >
    window.onload = function() {
        // var pre = document.getElementsByTagName('pre');
        var pre = document.querySelectorAll("pre.rouge");
        for (var i = 0; i < pre.length; i++) {
            var b = document.createElement('button');
            b.className = 'clipboard';
            b.textContent = 'Copier';
            if (pre[i].childNodes.length === 1 && pre[i].childNodes[0].nodeType === 3) {
                var div = document.createElement('div');
                div.textContent = pre[i].textContent;
                pre[i].textContent = '';
                pre[i].appendChild(div);
            }
            pre[i].appendChild(b);
        }
        var clipboard = new ClipboardJS('.clipboard', {
           target: function(b) {
                var p = b.parentNode;
                if (p.className.includes("rouge highlight")) {
                    var elems = p.getElementsByTagName("code");
                    if (elems.length > 0)
                        return elems[0];
                }
                return p.childNodes[0];
            }
        });
        clipboard.on('success', function(e) {
            e.clearSelection();
            e.trigger.textContent = 'Copié';
            setTimeout(function() {
                e.trigger.textContent = 'Copier';
            }, 2000);
        });
        clipboard.on('error', function(e) {
            console.error('Action:', e.action, e);
            console.error('Trigger:', e.trigger);
        });
    };
</script>
</head>
<body id="partie1" class="book toc2 toc-left">
<div id="header">
<h1>Workshop Java SE en 2024</h1>
<div class="details">
<span id="author" class="author">Par Clément de Tastes et J.M. Doudoux</span><br>
<span id="revnumber">version 1.0.0,</span>
<span id="revdate">2024-07-06</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table des matières</div>
<p><span class="toc-root"><a href="index.html">Workshop Java SE en 2024</a></span></p><ul class="sectlevel1">
<li><a href="introduction.html">1. Introduction</a>
</li>
<li><a href="requis.html">2. Les requis</a>
</li>
<li><a href="deroulement.html">3. Le déroulement du workshop</a>
</li>
<li><a href="partie1.html"><span class="toc-current">4. Partie 1 : les évolutions dans la syntaxe</span></a>
<ul class="sectlevel2">
<li><a href="partie1.html#_la_manipulation_de_chaînes_de_caractères">4.1. La manipulation de chaînes de caractères</a>
<ul class="sectlevel3">
<li><a href="partie1.html#text-blocks">4.1.1. Lab : les Text Blocks</a>
</li>
<li><a href="partie1.html#_lab_les_string_templates">4.1.2. Lab : les String Templates</a>
</li>
</ul>
</li>
<li><a href="partie1.html#_les_switch_expressions_et_la_gestion_de_types">4.2. Les Switch expressions et la gestion de types</a>
<ul class="sectlevel3">
<li><a href="partie1.html#_lab_les_switch_expressions">4.2.1. Lab : les Switch Expressions</a>
</li>
<li><a href="partie1.html#records">4.2.2. Lab : les Records</a>
</li>
<li><a href="partie1.html#classes-scellees">4.2.3. Lab : les classes scellées</a>
</li>
</ul>
</li>
<li><a href="partie1.html#_le_pattern_matching">4.3. Le Pattern matching</a>
<ul class="sectlevel3">
<li><a href="partie1.html#pattern-matching-for-instanceof">4.3.1. Lab : le Pattern Matching for instanceof</a>
</li>
<li><a href="partie1.html#record-patterns">4.3.2. Lab : les Record Patterns</a>
</li>
<li><a href="partie1.html#pattern-matching-switch">4.3.3. Lab : le Pattern Matching for switch</a>
</li>
</ul>
</li>
<li><a href="partie1.html#_les_autres_évolutions_syntaxiques">4.4. Les autres évolutions syntaxiques</a>
<ul class="sectlevel3">
<li><a href="partie1.html#unnamed-variables-patterns">4.4.1. Lab : les Unnamed Variables &amp; Patterns</a>
</li>
<li><a href="partie1.html#_lab_les_statements_before_super">4.4.2. Lab : les Statements Before Super(&#8230;&#8203;)</a>
</li>
<li><a href="partie1.html#implicit-classes-main-method">4.4.3. Lab : les Implicitly Declared Classes and Instance Main Methods</a>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="partie2.html">5. Partie 2 : les évolutions dans les API</a>
</li>
<li><a href="partie3.html">6. Partie 3 : l&#8217;outillage du JDK</a>
</li>
<li><a href="conclusion.html">7. Conclusion</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="partie1"><a class="anchor" href="#partie1"></a>4. Partie 1 : les évolutions dans la syntaxe</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Cette partie propose plusieurs labs pour mettre en œuvre les évolutions syntaxiques, principalement issues des travaux du projet <a href="https://openjdk.org/projects/amber/">Amber</a> d&#8217;OpenJDK.</p>
</div>
<div class="sect2">
<h3 id="_la_manipulation_de_chaînes_de_caractères"><a class="anchor" href="#_la_manipulation_de_chaînes_de_caractères"></a>4.1. La manipulation de chaînes de caractères</h3>
<div class="paragraph">
<p>Plusieurs évolutions de la syntaxe concernent la manipulation des chaînes de caractères.</p>
</div>
<div class="sect3">
<h4 id="text-blocks"><a class="anchor" href="#text-blocks"></a>4.1.1. Lab : les Text Blocks</h4>
<div class="paragraph">
<p>Java 15 enrichit le langage en y apportant le concept de Text Block, permettant la représentation de chaînes de caractères multilignes. Définir de telles chaînes de caractères impliquait jusque-là des manipulations assez verbeuses rendant la lecture et la maintenance fastidieuse.<br>
Cette nouvelle syntaxe apporte une nette simplification dans la définition de telles chaînes de caractères, ainsi que quelques fonctionnalités que nous allons détailler.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JDK</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Première preview en Java 13 <a href="https://openjdk.org/jeps/355">JEP 355</a>. Standard en Java 15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JEP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openjdk.org/jeps/378">378: Text Blocks</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Pour définir un Text Block, la syntaxe est la suivante :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>il débute par le délimiteur composé de :</p>
<div class="ulist">
<ul>
<li>
<p><code>"""</code> (triple guillemets doubles successifs)</p>
</li>
<li>
<p>suivi de zéro ou plus caractères d&#8217;espacement</p>
</li>
<li>
<p>et enfin obligatoirement d&#8217;un caractère de fin de ligne (comme <code>\r</code>, <code>\n</code>, <code>\r\n</code>, &#8230;&#8203;)</p>
</li>
</ul>
</div>
</li>
<li>
<p>il se termine par le délimiteur :</p>
<div class="ulist">
<ul>
<li>
<p><code>"""</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Compléter la méthode <code>afficherMessageAccueil()</code> de la classe <code>fr.sciam.workshop.javase.textblocks.TextBlocks</code> en définissant une chaîne de caractères multiligne avec un Text Block et l&#8217;afficher :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afficherMessageAccueil</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"""
        Bienvenue
        dans
        cet atelier"""</span><span class="o">;</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>TextBlocks</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Afficher message d'accueil
Bienvenue
dans
cet atelier</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
On notera que l&#8217;indentation a disparu. Cela est normal et ce point sera abordé un peu plus tard.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Toujours dans la classe <code>TextBlocks</code>, modifier la méthode <code>fournirChaineVide()</code> en transformant la chaîne de caractères littérale en Text Block. Elle doit toujours renvoyer une chaîne vide.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">fournirChaineVide</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">return</span> <span class="s">"""
"""</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter le test unitaire <code>TextBlocksTest::fournirChaineVide_devraitRenvoyerChaineVide</code> pour vérifier qu&#8217;il est toujours en succès.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Évidemment, utiliser un Text Block pour cela n&#8217;a pas d&#8217;intérêt et n&#8217;est pas recommandé, mais cela illustre bien le fait que le délimiteur de début d&#8217;un Text Block contient un caractère de fin de ligne, après les 3 guillemets doubles (et les potentiels espaces).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Recopier ces deux lignes dans la méthode <code>main()</code> de la classe <code>TextBlocks</code> ou dans un terminal <code>jshell</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">s1</span> <span class="o">=</span> <span class="s">""" """</span><span class="o">;</span>
<span class="nc">String</span> <span class="n">s2</span> <span class="o">=</span> <span class="s">"""
"</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater qu&#8217;aucun des deux Text Blocks n&#8217;est valide syntaxiquement.<br>
Le premier ne comporte pas de caractère de fin de ligne après les 3 guillemets doubles ouvrants.<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plain">jshell&gt; String s1 = """ """;
|  Error:
|  illegal text block open delimiter sequence, missing line terminator
|  String str = """ """;
|                   ^</code></pre>
</div>
</div>
<div class="paragraph">
<p>Le second ne comporte pas de délimiteur de fin.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plain">jshell&gt; String s2 = """
   ...&gt; ";
   ...&gt; // On est encore en train de saisir le contenu du Text Block</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>La syntaxe des Text Blocks permet également de ne pas avoir à échapper les guillemets doubles présents, comme on aurait dû traditionnellement le faire avec une chaîne de caractères standard.</p>
</div>
<div class="paragraph">
<p>Supprimer ces deux lignes afin que le code compile à nouveau.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Dans la classe <code>TextBlocks</code>, réécrire la méthode <code>fournirRequeteSQL()</code> en utilisant un Text Block en lieu et place de cette concaténation.</p>
</div>
<div class="listingblock">
<div class="title">Code initial</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">requete</span> <span class="o">=</span> <span class="s">"SELECT *\n"</span> <span class="o">+</span>
                 <span class="s">"FROM \"utilisateurs\"\n"</span> <span class="o">+</span>
                 <span class="s">"WHERE \"nom\" = 'Duke';"</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Code modifié avec utilisation d&#8217;un Text Block</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">requete</span> <span class="o">=</span> <span class="s">"""
         SELECT *
         FROM "</span><span class="n">utilisateurs</span><span class="s">"
         WHERE "</span><span class="n">nom</span><span class="s">" = 'Duke';"""</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter le test unitaire <code>TextBlocksTest::fournirRequeteSQL_devraitRenvoyerRequeteCorrecte</code> pour vérifier que le résultat est équivalent.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_les_traitements_au_moment_de_la_compilation"><a class="anchor" href="#_les_traitements_au_moment_de_la_compilation"></a>4.1.1.1. Les traitements au moment de la compilation</h5>
<div class="paragraph">
<p>Un Text Block est une expression constante qui contrairement aux <code>String</code>, va subir plusieurs traitements par le compilateur :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Les caractères de fin de ligne sont transformés en <code>\n</code> (<code>\u000a</code>) afin d&#8217;assurer que le contenu du Text Block soit le même entre les plateformes (Windows, Linux, &#8230;&#8203;)</p>
</li>
<li>
<p>Les espacements dits accessoires sont retirés. Ceci permet de présenter le Text Block de manière cohérente en termes d&#8217;indentation de code et le rend plus naturellement compatible de ce que l&#8217;on aurait écrit via des concaténations de caractères.<br>
Cela concerne les caractères d&#8217;espacement qui constituent "l&#8217;indentation" minimale du bloc comme il est présenté, "à gauche" du bloc.<br>
Aussi, les espaces qui sont présents en fin de chaque ligne "à droite" sont supprimés. Ils sont dans l&#8217;écrasante majorité des cas des espaces non-intentionnels. Comme ils sont invisibles, ils pourraient conduire à des comportements imprévisibles, d&#8217;où ce choix de comportement du compilateur.</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Dans la classe <code>TextBlocks</code>, réécrire la méthode <code>fournirCodeHTML()</code> en utilisant un Text Block en lieu et place de la concaténation.</p>
</div>
<div class="listingblock">
<div class="title">Code modifié avec utilisation d&#8217;un Text Block</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">html</span> <span class="o">=</span> <span class="s">"""
        &lt;body&gt;
            &lt;h2&gt;Login&lt;/h2&gt;
            &lt;form&gt;
                &lt;input type="</span><span class="n">text</span><span class="s">" name="</span><span class="n">login</span><span class="s">" required&gt;
                &lt;input type="</span><span class="n">submit</span><span class="s">" value="</span><span class="nc">Login</span><span class="s">"&gt;
            &lt;/form&gt;
        &lt;/body&gt;
        """</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter le test unitaire <code>TextBlocksTest::fournirCodeHTML_devraitRenvoyerCodeCorrect</code> pour constater que le résultat obtenu est identique.</p>
</div>
<div class="paragraph">
<p>Toujours dans la méthode <code>fournirCodeHTML()</code>, modifier librement l&#8217;indentation globale du bloc et ajouter des espaces en fin de ligne après la balise <code>&lt;body&gt;</code> ou <code>&lt;form&gt;</code> par exemple.</p>
</div>
<div class="listingblock">
<div class="title">Code avec modifications d&#8217;espacements accessoires.</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">html</span> <span class="o">=</span> <span class="s">"""
                    &lt;body&gt;
                        &lt;h2&gt;Login&lt;/h2&gt;
                        &lt;form&gt;
                            &lt;input type="</span><span class="n">text</span><span class="s">" name="</span><span class="n">login</span><span class="s">" required&gt;
                            &lt;input type="</span><span class="n">submit</span><span class="s">" value="</span><span class="nc">Login</span><span class="s">"&gt;
                        &lt;/form&gt;
                    &lt;/body&gt;
                    """</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter à nouveau le test unitaire <code>TextBlocksTest::fournirCodeHTML_devraitRenvoyerCodeCorrect</code> pour constater que le résultat n&#8217;a pas été altéré.</p>
</div>
<div class="paragraph">
<p>On constate que les espacements représentés par des "<strong>.</strong>" sont bien retirés par le compilateur.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">html</span> <span class="o">=</span> <span class="s">"""
..........&lt;body&gt;...
..........    &lt;h2&gt;Login&lt;/h2&gt;.......
..........    &lt;form&gt;
..........        &lt;input type="</span><span class="n">text</span><span class="s">" name="</span><span class="n">login</span><span class="s">" required&gt;...
..........        &lt;input type="</span><span class="n">submit</span><span class="s">" value="</span><span class="nc">Login</span><span class="s">"&gt;
..........    &lt;/form&gt;
..........&lt;/body&gt;
.........."""</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On fait donc une différence entre les espacements accessoires qui ne servent qu&#8217;à la présentation et à la lisibilité du code, des espacements significatifs qui seront conservés dans la chaîne de caractères finale.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Le compilateur traite les caractères d&#8217;espacement comme ayant des longueurs identiques (une tabulation et un espace auront la même longueur). Donc, vigilance au mélange de différents types d&#8217;espacements. En activant l&#8217;option du compilateur <code>-Xlint:text-blocks</code> un tel cas de figure ressort en warning.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
<li>
<p>Enfin, les échappements sont interprétés, tels qu&#8217;un <code>\n</code> ajouté par l&#8217;utilisateur.
Ceci est fait en dernier afin que les étapes précédentes ne viennent modifier ou supprimer de tels éléments.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_les_séquences_déchappement"><a class="anchor" href="#_les_séquences_déchappement"></a>4.1.1.2. Les séquences d&#8217;échappement</h5>
<div class="paragraph">
<p>Comme on a pu le voir, les Text Blocks nous ont permis de ne pas avoir recours aux caractères d&#8217;échappements. Ceci est valable pour la majorité des usages, mais il existe quelques cas de figure pour lesquels cela peut être nécessaire.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>\&lt;fin de ligne&gt;</code> : supprime le saut de ligne.
La ligne courante sera donc concaténée avec la suivante</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier le code de la méthode <code>fournirMessage()</code> de la classe <code>TextBlocks</code> en y ajoutant des caractères d&#8217;échappements <code>\</code>.</p>
</div>
<div class="listingblock">
<div class="title">Code initial</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"Bienvenue dans cet atelier"</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Code modifié</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"""
        Bienvenue \
        dans cet \
        atelier"""</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter le test unitaire <code>TextBlocksTest::fournirMessage_devraitRenvoyerUneLigne</code> pour constater que le résultat est identique au précédent.</p>
</div>
</div>
</div>
</li>
<li>
<p>3 guillemets doubles successifs seraient interprétés comme le délimiteur de fin du Text Block, on doit donc échapper au moins un des guillemets (<code>\"""</code> par exemple) pour les interpréter comme caractères.</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>fournirExplication()</code> de <code>TextBlock</code> en utilisant un Text Block et la bonne séquence d&#8217;échappement.</p>
</div>
<div class="listingblock">
<div class="title">Code initial</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">explication</span> <span class="o">=</span> <span class="s">"Le délimiteur de fin d'un Text Block est : \"\"\""</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Code modifié</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">explication</span> <span class="o">=</span> <span class="s">"""
      Le délimiteur de fin d'un Text Block est : ""\""""</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter le test unitaire <code>TextBlocksTest::fournirExplication_devraitRenvoyerExplication</code> pour constater que le résultat est identique au précédent.</p>
</div>
</div>
</div>
</li>
<li>
<p><code>\s</code> : ajoute un espace, et a pour conséquence de conserver les espaces qui seraient placés avant</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>fournirEspaces()</code> de <code>TextBlock</code> en utilisant un Text Block et la bonne séquence d&#8217;échappement.</p>
</div>
<div class="listingblock">
<div class="title">Code initial</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">espaces</span> <span class="o">=</span> <span class="s">"Voici 5 espaces:     \n"</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Code modifié</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">espaces</span> <span class="o">=</span> <span class="s">"""
      Voici 5 espaces:    \s
      """</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que le résultat est identique au précédent en exécutant le test unitaire <code>TextBlocksTest::fournirEspaces_devraitRenvoyer5Espaces</code>.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_les_nouvelles_méthodes_de_la_classe_string"><a class="anchor" href="#_les_nouvelles_méthodes_de_la_classe_string"></a>4.1.1.3. Les nouvelles méthodes de la classe <code>String</code></h5>
<div class="paragraph">
<p>3 nouvelles méthodes ont été ajoutées dans la classe <code>String</code>, en rapport avec les Text Blocks.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>String::stripIndent</code> : permet la suppression des espaces accessoires</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Dans la méthode <code>main()</code>, utiliser la méthode <code>String::stripIndent</code> sur une chaîne de caractères contenant des espaces accessoires et l&#8217;afficher.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">str</span> <span class="o">=</span> <span class="s">"  A\n  B\n  C\n  "</span><span class="o">.</span><span class="na">stripIndent</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">str</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter le programme pour constater qu&#8217;il affiche :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>A
B
C</pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><code>String::translateEscapes</code> : convertit les caractères échappés en leurs valeurs respectives</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Dans la méthode <code>main()</code>, ajouter le code suivant et l&#8217;exécuter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">boolean</span> <span class="n">egal</span> <span class="o">=</span> <span class="s">"\n \s \r"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"\\n \\s \\r"</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Egal : "</span> <span class="o">+</span> <span class="n">egal</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vérifier que les chaînes sont bel et bien <strong>différentes</strong> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plain">Egal : false</code></pre>
</div>
</div>
<div class="paragraph">
<p>Modifier le code en ajoutant un appel à <code>String::translateEscapes</code> afin de convertir les caractères échappés.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">boolean</span> <span class="n">egal</span> <span class="o">=</span> <span class="s">"\n \s \r"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"\\n \\s \\r"</span><span class="o">.</span><span class="na">translateEscapes</span><span class="o">());</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Egal : "</span> <span class="o">+</span> <span class="n">egal</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vérifier que les chaînes sont désormais <strong>identiques</strong> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plain">Egal : true</code></pre>
</div>
</div>
</div>
</div>
</li>
<li>
<p><code>String::formatted</code> : identique à la méthode statique <code>String::format</code>, si ce n&#8217;est que c&#8217;est ici une méthode d&#8217;instance.</p>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>fournirRequeteSQLAvecParametre()</code> pour utiliser un Text Block et prendre en compte le paramètre <code>nom</code> avec <code>String::formatted</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">fournirRequeteSQLAvecParametre</span><span class="o">(</span><span class="nc">String</span> <span class="n">nom</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">String</span> <span class="n">requete</span> <span class="o">=</span> <span class="s">"""
         SELECT *
         FROM "</span><span class="n">utilisateurs</span><span class="s">"
         WHERE "</span><span class="n">nom</span><span class="s">" = '%s';"""</span><span class="o">.</span><span class="na">formatted</span><span class="o">(</span><span class="n">nom</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">requete</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vérifier que la méthode fonctionne comme attendu en exécutant le test unitaire <code>TextBlocksTest::fournirRequeteSQLAvecParametre_devraitRenvoyerRequeteFormatee</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
On note qu&#8217;un Text Block reste bien bel et bien une chaîne de caractères : <code>WHERE "nom"</code> est une condition sur la colonne "nom", il ne s&#8217;agit pas de l&#8217;argument de la méthode.
</td>
</tr>
</table>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_les_text_blocks_et_la_concaténation"><a class="anchor" href="#_les_text_blocks_et_la_concaténation"></a>4.1.1.4. Les Text Blocks et la concaténation</h5>
<div class="paragraph">
<p>L&#8217;utilisation de la méthode <code>String::formatted</code> peut tout à fait laisser la place à une "simple" concaténation entre notre Text Block et l&#8217;argument.<br>
Plus généralement, un Text Block étant transformé par le compilateur en une chaîne de caractères de type String, les règles habituelles s&#8217;appliquent.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier à nouveau la méthode <code>fournirRequeteSQLAvecParametre()</code> en utilisant une concaténation plutôt qu&#8217;un appel à la méthode <code>String::formatted</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">fournirRequeteSQL</span><span class="o">(</span><span class="nc">String</span> <span class="n">nom</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">String</span> <span class="n">requete</span> <span class="o">=</span> <span class="s">"""
         SELECT *
         FROM "</span><span class="n">utilisateurs</span><span class="s">"
         WHERE "</span><span class="n">nom</span><span class="s">" = '"""</span> <span class="o">+</span> <span class="n">nom</span> <span class="o">+</span> <span class="s">"';"</span><span class="o">;</span>

  <span class="k">return</span> <span class="n">requete</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vérifier que la méthode fonctionne toujours comme attendu en exécutant à nouveau le test unitaire <code>TextBlocksTest::fournirRequeteSQLAvecParametre_devraitRenvoyerRequeteFormatee</code></p>
</div>
<div class="paragraph">
<p>On a donc ici concaténé un Text Block, une variable de type <code>String</code> et une chaîne de caractères littérale.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lab_les_string_templates"><a class="anchor" href="#_lab_les_string_templates"></a>4.1.2. Lab : les String Templates</h4>
<div class="paragraph">
<p>Il est courant de devoir composer des chaînes de caractères à partir d&#8217;une combinaison de textes littéraux et de valeurs ou d&#8217;expressions.</p>
</div>
<div class="paragraph">
<p>Pour cela, diverses possibilités s&#8217;offrent aux développeurs : concaténation avec l&#8217;opérateur <code>+</code>, méthode <code>String::format</code> ou <code>String::formatted</code>, <code>MessageFormat</code>, <code>StringBuilder</code>, &#8230;&#8203; qui présentent certaines lourdeurs en termes de lisibilité et verbosité.</p>
</div>
<div class="paragraph">
<p>Le but des String Templates est d&#8217;enrichir le langage avec le concept d&#8217;interpolation, déjà présent dans d&#8217;autres langages, en complément des chaînes de caractères et blocs de texte.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
La fonctionnalité étant en preview et soumise à débats, son contenu va changer de manière importante dans la prochaine preview. Il est déjà planifié que la fonctionnalité ne soit pas disponible en preview en Java 23.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JDK</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Première preview en Java 21 <a href="https://openjdk.org/jeps/430">JEP 430</a>. Second preview en Java 22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JEP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openjdk.org/jeps/459">459: String Templates (Second Preview)</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
En Java 22, cette fonctionnalité est <a href="deroulement.html#preview">en preview</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Les String Templates combinent un texte littéral avec des expressions intégrées et un processeur de templates pour construire des chaînes de caractères dynamiquement avec la clarté de l&#8217;interpolation et un résultat plus sûr.</p>
</div>
<div class="paragraph">
<p>Pour cela, un nouveau type d&#8217;expression est introduit dans le langage : les templates expressions pour effectuer une interpolation de chaîne pour créer une chaîne ou un objet.</p>
</div>
<div class="paragraph">
<p>La syntaxe est la suivante :</p>
</div>
<div class="listingblock">
<div class="title">Exemple de String Template</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="nc">String</span> <span class="n">version</span> <span class="o">=</span> <span class="s">"22"</span><span class="o">;</span>
<span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="no">STR</span><span class="o">.</span><span class="s">"Java version \{version}"</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Une template expression est composée de trois éléments :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>un processeur de templates (<code>STR</code> dans l&#8217;exemple ci-dessus),</p>
</li>
<li>
<p>suivi d&#8217;un caractère point <code>.</code>,</p>
</li>
<li>
<p>puis d&#8217;un template comme <code>"Java version \{version}"</code> qui contient une ou plusieurs expressions intégrées comme <code>\{version}</code>.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Une chaîne de caractères littérale ne peut pas contenir une expression de la forme  <code>\{xxx}</code> sinon une erreur est émise par le compilateur, car dans ce cas la valeur littérale est considérée comme un template qui doit donc être obligatoirement préfixé par un processeur de templates pour être valide.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>jshell&gt; String message = "Bonjour \{prenom}";
|  Error:
|  processor missing from string template expression
|  String message = "Bonjour \{prenom}";
|</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_le_processeur_de_templates_stringtemplate_str"><a class="anchor" href="#_le_processeur_de_templates_stringtemplate_str"></a>4.1.2.1. Le processeur de templates <code>StringTemplate.STR</code></h5>
<div class="paragraph">
<p>Le processeur de templates <code>java.lang.StringTemplate.STR</code> effectue une interpolation pour créer une chaîne de caractères.
<code>STR</code> est un champ <code>static</code> implicitement et automatiquement importé, comme les types du package <code>java.lang</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Dans la classe <code>fr.sciam.workshop.javase.stringtemplates.MainStringTemplates</code>, compléter la méthode <code>manipulerStr()</code> pour afficher le prénom et le nom en utilisant un String Template avec le processeur <code>STR</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">manipulerStr</span><span class="o">(</span><span class="nc">String</span> <span class="n">prenom</span><span class="o">,</span> <span class="nc">String</span> <span class="n">nom</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="no">STR</span><span class="o">.</span><span class="s">"Prénom : \{prenom}, Nom : \{nom}"</span><span class="o">;</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainStringTemplates</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Affichage de l'identité :
Prénom : Luke, Nom : Skywalker</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Il est possible de ne pas se limiter à l&#8217;utilisation de variables dans le String Template : on peut utiliser des expressions comme le résultat d&#8217;un calcul arithmétique ou de l&#8217;invocation d&#8217;une méthode.</p>
</div>
<div class="listingblock">
<div class="title">Exemple</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span>
<span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="no">STR</span><span class="o">.</span><span class="s">"x : \{x}, y : \{y}, somme : \{x + y}"</span><span class="o">;</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>manipulerStr()</code> pour afficher le nom en majuscule dans le Template, grâce à la méthode <code>String::toUpperCase()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">manipulerStr</span><span class="o">(</span><span class="nc">String</span> <span class="n">prenom</span><span class="o">,</span> <span class="nc">String</span> <span class="n">nom</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="no">STR</span><span class="o">.</span><span class="s">"Prénom : \{prenom}, Nom : \{nom.toUpperCase()}"</span><span class="o">;</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainStringTemplates</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Manipuler STR
Prénom : Luke, Nom : SKYWALKER</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Le String Template peut être défini comme étant multiligne via une syntaxe identique à celles des blocs de texte.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>manipulerStr()</code> pour afficher le prénom et le nom sur deux lignes distinctes en utilisant la syntaxe des blocs de texte.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Le concept de blocs de texte est abordé dans le lab <a href="partie1.html#text-blocks">les Text Blocks</a>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">manipulerStr</span><span class="o">(</span><span class="nc">String</span> <span class="n">prenom</span><span class="o">,</span> <span class="nc">String</span> <span class="n">nom</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="no">STR</span><span class="o">.</span><span class="s">"""
      Prénom : \{prenom}
      Nom : \{nom}"""</span><span class="o">;</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainStringTemplates</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Processeur STR
Prénom : Luke
Nom : Skywalker</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_le_processeur_de_templates_formatprocessor_fmt"><a class="anchor" href="#_le_processeur_de_templates_formatprocessor_fmt"></a>4.1.2.2. Le processeur de templates <code>FormatProcessor.FMT</code></h5>
<div class="paragraph">
<p>Le processeur <code>java.util.FormatProcessor.FMT</code> effectue une interpolation pour créer une chaîne.
Il interprète les spécificateurs de format à gauche des expressions intégrées.
Les spécificateurs de format sont ceux définis dans <code>java.util.Formatter</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Compléter la méthode <code>manipulerFmt</code> pour afficher un texte suivi de la valeur de <code>Math.PI</code> avec une précision de 5 décimales.
Utiliser pour cela le format <code>%.5f</code> et l&#8217;import <code>static</code> de <code>java.util.FormatProcessor.FMT</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kn">import</span> <span class="nn">static</span> <span class="n">java</span><span class="o">.</span><span class="na">util</span><span class="o">.</span><span class="na">FormatProcessor</span><span class="o">.</span><span class="na">FMT</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">manipulerFmt</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="no">FMT</span><span class="o">.</span><span class="s">"Pi vaut environ : %.5f\{Math.PI}"</span><span class="o">;</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainStringTemplates</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Manipuler FMT
Pi vaut environ : 3.14159</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_le_processeur_de_templates_stringtemplate_raw"><a class="anchor" href="#_le_processeur_de_templates_stringtemplate_raw"></a>4.1.2.3. Le processeur de templates <code>StringTemplate.RAW</code></h5>
<div class="paragraph">
<p>Le processeur <code>java.lang.StringTemplate.RAW</code> produit un objet de type <code>StringTemplate</code>.
Cette instance peut être passée comme paramètre d&#8217;un processeur de templates via la méthode <code>StringTemplate.Processor::process</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Compléter la méthode <code>manipulerRaw()</code> pour obtenir une instance de <code>StringTemplate</code> à partir du template <code>"Star Wars est sorti au cinema en \{annee}."</code> et du processeur <code>RAW</code> et l&#8217;import <code>static</code> de <code>java.lang.StringTemplate.RAW</code>.
Puis invoquer la méthode <code>process()</code> de <code>STR</code> avec cette instance.</p>
</div>
<div class="paragraph">
<p>Enfin, afficher dans la console l&#8217;instance de <code>StringTemplate</code> et la chaîne de caractères obtenues.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kn">import</span> <span class="nn">static</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">StringTemplate</span><span class="o">.</span><span class="na">RAW</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">manipulerRaw</span><span class="o">(</span><span class="kt">int</span> <span class="n">annee</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">StringTemplate</span> <span class="n">template</span> <span class="o">=</span> <span class="no">RAW</span><span class="o">.</span><span class="s">"Star Wars est sorti au cinema en \{annee}."</span><span class="o">;</span>
    <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="no">STR</span><span class="o">.</span><span class="na">process</span><span class="o">(</span><span class="n">template</span><span class="o">);</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">template</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainStringTemplates</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Manipuler RAW
StringTemplate{ fragments = [ "Star Wars est sorti au cinema en ", "." ], values = [1977] }
Star Wars est sorti au cinema en 1977.</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_les_processeurs_personnalisés"><a class="anchor" href="#_les_processeurs_personnalisés"></a>4.1.2.4. Les processeurs personnalisés</h5>
<div class="paragraph">
<p>Il est possible de définir des processeurs de templates personnalisés.
Pour cela, il faut obtenir une instance de l&#8217;interface fonctionnelle <code>StringTemplate.Processor</code> qui implémente l&#8217;unique méthode <code>process()</code>.
L&#8217;utilisation de la fabrique <code>StringTemplate.Processor::of</code> permet d&#8217;en obtenir une instance.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Compléter la méthode <code>creerProcesseurPersonnalise()</code>, afin de créer et renvoyer un processeur de templates personnalisé qui réalise les traitements suivants :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Vérifie qu&#8217;il n&#8217;y a qu&#8217;une seule valeur fournie de type entier (valeurs obtenues via <code>StringTemplate::values</code>)</p>
</li>
<li>
<p>Vérifie que la valeur est strictement positive</p>
</li>
<li>
<p>Effectue l&#8217;interpolation via <code>StringTemplate::interpolate</code></p>
</li>
<li>
<p>Encode le résultat en base 64 via <code>Base64.getEncoder().encode()</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Processor</span><span class="o">&lt;</span><span class="kt">byte</span><span class="o">[],</span> <span class="nc">RuntimeException</span><span class="o">&gt;</span> <span class="nf">creerProcesseurPersonnalise</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">StringTemplate</span><span class="o">.</span><span class="na">Processor</span><span class="o">.</span><span class="na">of</span><span class="o">((</span><span class="nc">StringTemplate</span> <span class="n">st</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>

      <span class="c1">// vérification des paramètres</span>
      <span class="nc">Object</span> <span class="n">valeur</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="na">values</span><span class="o">().</span><span class="na">getFirst</span><span class="o">();</span>
      <span class="k">if</span> <span class="o">(</span><span class="n">valeur</span> <span class="k">instanceof</span> <span class="nc">Integer</span> <span class="n">entier</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">entier</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="no">STR</span><span class="o">.</span><span class="s">"Nombre de langues négatif : \{entier}"</span><span class="o">);</span>
        <span class="o">}</span>
      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Nombre de langues invalide"</span><span class="o">);</span>
      <span class="o">}</span>

      <span class="c1">// interpolation</span>
      <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="na">interpolate</span><span class="o">();</span>

      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="no">STR</span><span class="o">.</span><span class="s">"STR : \{message}"</span><span class="o">);</span>

      <span class="c1">// Transformer en base 64</span>
      <span class="k">return</span> <span class="nc">Base64</span><span class="o">.</span><span class="na">getEncoder</span><span class="o">().</span><span class="na">encode</span><span class="o">(</span><span class="n">message</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
    <span class="o">});</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Puis compléter la méthode <code>manipulerProcesseurPersonnalise()</code> pour obtenir une instance de ce processeur personnalisé avec <code>creerProcesseurPersonnalise()</code>.</p>
</div>
<div class="paragraph">
<p>Utiliser ce processeur avec l&#8217;expression template <code>"C-3PO parle \{languesC3PO} de formes de communication"</code>. Afficher le résultat avec la méthode <code>afficherB64()</code>. Faire de même avec l&#8217;expression template <code>"Jabba le Hutt parle \{languesJabba} langues"</code> en gérant l&#8217;exception.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">manipulerProcesseurPersonnalise</span><span class="o">(</span><span class="kt">int</span> <span class="n">languesC3PO</span><span class="o">,</span> <span class="kt">int</span> <span class="n">languesJabba</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="no">L64</span> <span class="o">=</span> <span class="n">creerProcesseurPersonnalise</span><span class="o">();</span>

    <span class="kt">byte</span><span class="o">[]</span> <span class="n">octets</span> <span class="o">=</span> <span class="no">L64</span><span class="o">.</span><span class="s">"C-3PO parle \{languesC3PO} de formes de communication"</span><span class="o">;</span>
    <span class="n">afficherB64</span><span class="o">(</span><span class="n">octets</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
      <span class="n">octets</span> <span class="o">=</span> <span class="no">L64</span><span class="o">.</span><span class="s">"Jabba le Hutt parle \{languesJabba} langues"</span><span class="o">;</span>
      <span class="n">afficherB64</span><span class="o">(</span><span class="n">octets</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainStringTemplates</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Processeur personnalisé
STR : C-3PO parle 6000000 de formes de communication
51 79 30 7a 55 45 38 67 63 47 46 79 62 47 55 67 4e 6a 41 77 4d 44 41 77 4d 43 42 6b 5a 53 42 6d 62 33 4a 74 5a 58 4d 67 5a 47 55 67 59 32 39 74 62 58 56 75 61 57 4e 68 64 47 6c 76 62 67 3d 3d

java.lang.IllegalArgumentException: Nombre de langues négatif : -2
	at fr.sciam.workshop.javase.stringtemplates.MainStringTemplates.lambda$creerProcesseurPersonnalise$0(MainStringTemplates.java:72)
	at fr.sciam.workshop.javase.stringtemplates.MainStringTemplates.manipulerProcesseurPersonnalise(MainStringTemplates.java:58)
	at fr.sciam.workshop.javase.stringtemplates.MainStringTemplates.main(MainStringTemplates.java:27)</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_les_switch_expressions_et_la_gestion_de_types"><a class="anchor" href="#_les_switch_expressions_et_la_gestion_de_types"></a>4.2. Les Switch expressions et la gestion de types</h3>
<div class="paragraph">
<p>Plusieurs évolutions de la syntaxe concernent la syntaxe et l&#8217;utilisation de l&#8217;instruction <code>switch</code> et la gestion de types.</p>
</div>
<div class="sect3">
<h4 id="_lab_les_switch_expressions"><a class="anchor" href="#_lab_les_switch_expressions"></a>4.2.1. Lab : les Switch Expressions</h4>
<div class="paragraph">
<p>Le JDK 14 vient enrichir le langage d&#8217;une nouvelle syntaxe pour l&#8217;instruction <code>switch</code> avec l&#8217;opérateur "arrow" <code>-&gt;</code>, le support des multi-valeurs ainsi que la possibilité de l&#8217;utiliser comme expression.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JDK</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Première preview en Java 12 <a href="https://openjdk.org/jeps/425">JEP 425</a>. Standard en Java 14</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JEP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openjdk.org/jeps/361">361: Switch Expressions</a></p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_la_nouvelle_syntaxe"><a class="anchor" href="#_la_nouvelle_syntaxe"></a>4.2.1.1. La nouvelle syntaxe</h5>
<div class="paragraph">
<p>L&#8217;utilisation de ce nouvel opérateur "arrow" <code>-&gt;</code> implique :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>qu&#8217;il ne peut y avoir qu&#8217;une seule expression à droite de l&#8217;opérateur :</p>
<div class="ulist">
<ul>
<li>
<p>une unique instruction se terminant par un <code>;</code></p>
</li>
<li>
<p>ou bien un bloc de code délimité par des accolades <code>{</code> <code>}</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>qu&#8217;il n&#8217;y a pas de "fall-through" avec les <code>case</code> suivants</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
L&#8217;utilisation de la syntaxe historique avec les <code>case</code> / <code>break</code> est toujours valide.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Dans la classe <code>fr.sciam.workshop.javase.switchexpressions.Poker</code>, modifier la méthode <code>obtenirNomEtSymbole()</code> afin d&#8217;utiliser cette nouvelle syntaxe.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">obtenirNomEtSymbole</span><span class="o">(</span><span class="nc">TypeCarte</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>

  <span class="nc">String</span> <span class="n">nom</span><span class="o">;</span>

  <span class="k">switch</span> <span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">case</span> <span class="no">TREFLE</span> <span class="o">-&gt;</span> <span class="n">nom</span> <span class="o">=</span> <span class="s">"Trèfle ♣"</span><span class="o">;</span>
    <span class="k">case</span> <span class="no">CARREAU</span> <span class="o">-&gt;</span> <span class="n">nom</span> <span class="o">=</span> <span class="s">"Carreau ♦"</span><span class="o">;</span>
    <span class="k">case</span> <span class="no">COEUR</span> <span class="o">-&gt;</span> <span class="n">nom</span> <span class="o">=</span> <span class="s">"Cœur ♥"</span><span class="o">;</span>
    <span class="k">case</span> <span class="no">PIQUE</span> <span class="o">-&gt;</span> <span class="n">nom</span> <span class="o">=</span> <span class="s">"Pique ♠"</span><span class="o">;</span>
    <span class="k">default</span> <span class="o">-&gt;</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">(</span><span class="s">"Type '"</span> <span class="o">+</span> <span class="n">type</span> <span class="o">+</span> <span class="s">"' inconnu"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="k">return</span> <span class="n">nom</span><span class="o">;</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vérifier que le comportement de la méthode est toujours valide en exécutant le test unitaire <code>fr.sciam.workshop.javase.switchexpressions.PokerTest</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_lutilisation_de_switch_comme_expression"><a class="anchor" href="#_lutilisation_de_switch_comme_expression"></a>4.2.1.2. L&#8217;utilisation de <code>switch</code> comme expression</h5>
<div class="paragraph">
<p>La nouvelle syntaxe est plus concise.
Il est aussi possible d&#8217;utiliser l&#8217;instruction <code>switch</code> comme une expression et non plus seulement comme une structure de contrôle.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier à nouveau la méthode <code>obtenirNomEtSymbole()</code> de la classe <code>Poker</code> afin d&#8217;utiliser l&#8217;instruction <code>switch</code> comme une expression.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">obtenirNomEtSymbole</span><span class="o">(</span><span class="nc">TypeCarte</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>

  <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">case</span> <span class="no">TREFLE</span> <span class="o">-&gt;</span> <span class="s">"Trèfle ♣"</span><span class="o">;</span>
    <span class="k">case</span> <span class="no">CARREAU</span> <span class="o">-&gt;</span> <span class="s">"Carreau ♦"</span><span class="o">;</span>
    <span class="k">case</span> <span class="no">COEUR</span> <span class="o">-&gt;</span> <span class="s">"Cœur ♥"</span><span class="o">;</span>
    <span class="k">case</span> <span class="no">PIQUE</span> <span class="o">-&gt;</span> <span class="s">"Pique ♠"</span><span class="o">;</span>
  <span class="o">};</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter à nouveau le test unitaire <code>PokerTest</code> pour vérifier le bon fonctionnement de ce code.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Noter la présence indispensable du caractère <code>;</code> qui vient clôturer l&#8217;expression.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Noter également que l&#8217;on a pu s&#8217;abstraire du <code>default</code>, l&#8217;intégralité des valeurs possibles de notre énumération ayant été couverte. Ceci est possible car il s&#8217;agit d&#8217;un énumération. Dans les autres cas, il faudra généralement définir le cas par défaut, le <code>switch</code> devant être exhaustif pour éviter une erreur de compilation.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_la_gestion_des_valeurs_multiples"><a class="anchor" href="#_la_gestion_des_valeurs_multiples"></a>4.2.1.3. La gestion des valeurs multiples</h5>
<div class="paragraph">
<p>La syntaxe propose un support des valeurs multiples dans les deux syntaxes (historique et nouvelle) : il est désormais possible de lister plusieurs valeurs dans un <code>case</code> séparées par des virgules <code>,</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>obtenirCouleur()</code> de la classe <code>Poker</code> afin d&#8217;utiliser une expression et sa syntaxe multi-valeurs.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">obtenirCouleur</span><span class="o">(</span><span class="nc">TypeCarte</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>

  <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">case</span> <span class="no">TREFLE</span><span class="o">,</span> <span class="no">PIQUE</span> <span class="o">-&gt;</span> <span class="s">"noir"</span><span class="o">;</span>
    <span class="k">case</span> <span class="no">COEUR</span><span class="o">,</span> <span class="no">CARREAU</span> <span class="o">-&gt;</span> <span class="s">"rouge"</span><span class="o">;</span>
  <span class="o">};</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter à nouveau le test unitaire <code>PokerTest</code> pour vérifier le bon fonctionnement de ce code.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_lutilisation_de_yield"><a class="anchor" href="#_lutilisation_de_yield"></a>4.2.1.4. L&#8217;utilisation de <code>yield</code></h5>
<div class="paragraph">
<p>Pour une expression <code>switch</code> où l&#8217;on souhaite renvoyer une valeur dans un bloc de code, il faut utiliser le nouveau mot clé contextuel <code>yield</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>obtenirCouleur()</code> de la classe <code>Poker</code> en utilisant des blocs de code dans chaque <code>case</code> puis <code>yield</code> pour retourner le résultat.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">obtenirCouleur</span><span class="o">(</span><span class="nc">TypeCarte</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>

  <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">case</span> <span class="no">TREFLE</span><span class="o">,</span> <span class="no">PIQUE</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"♣ ou ♠"</span><span class="o">);</span>
      <span class="n">yield</span> <span class="s">"noir"</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">case</span> <span class="no">COEUR</span><span class="o">,</span> <span class="no">CARREAU</span> <span class="o">-&gt;</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"♥ ou ♦"</span><span class="o">);</span>
      <span class="n">yield</span> <span class="s">"rouge"</span><span class="o">;</span>
    <span class="o">}</span>
  <span class="o">};</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter à nouveau le test unitaire <code>PokerTest</code> pour vérifier le bon fonctionnement de ce code. Les valeurs retournées sont toujours celles attendues et l&#8217;on a affiché quelques messages :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>♣ ou ♠
♥ ou ♦
♥ ou ♦
♣ ou ♠</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_le_support_de_la_syntaxe_historique"><a class="anchor" href="#_le_support_de_la_syntaxe_historique"></a>4.2.1.5. Le support de la syntaxe historique</h5>
<div class="paragraph">
<p>L&#8217;instruction <code>yield</code> dans un <code>switch</code> comme expression et les valeurs multiples peuvent aussi être utilisées dans un <code>switch</code> qui utilise la syntaxe historique.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier à nouveau la méthode <code>obtenirCouleur()</code> de la classe <code>Poker</code> en utilisant la syntaxe historique <code>case</code> combinée avec l&#8217;utilisation de <code>yield</code> et <code>,</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">obtenirCouleur</span><span class="o">(</span><span class="nc">TypeCarte</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>

  <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">case</span> <span class="no">TREFLE</span><span class="o">,</span> <span class="nl">PIQUE:</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"♣ ou ♠"</span><span class="o">);</span>
      <span class="n">yield</span> <span class="s">"noir"</span><span class="o">;</span>

    <span class="k">case</span> <span class="no">COEUR</span><span class="o">,</span> <span class="nl">CARREAU:</span>
      <span class="n">yield</span> <span class="s">"rouge"</span><span class="o">;</span>
  <span class="o">};</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter à nouveau le test unitaire <code>PokerTest</code> pour vérifier le bon fonctionnement de ce code.</p>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Il n&#8217;est cependant pas possible de combiner la syntaxe historique qui utilise les <code>:</code> avec la nouvelle qui utilise <code>-&gt;</code>. L&#8217;instruction <code>switch</code> doit utiliser l&#8217;une ou l&#8217;autre des syntaxes.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>traduireType()</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">traduireType</span><span class="o">(</span><span class="nc">TypeCarte</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">type</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nl">TREFLE:</span> <span class="n">yield</span> <span class="s">"Club"</span><span class="o">;</span>
    <span class="k">case</span> <span class="no">CARREAU</span> <span class="o">-&gt;</span> <span class="s">"Diamond"</span><span class="o">;</span>
    <span class="k">case</span> <span class="no">COEUR</span> <span class="o">-&gt;</span> <span class="s">"Heart"</span><span class="o">;</span>
    <span class="k">case</span> <span class="no">PIQUE</span> <span class="o">-&gt;</span> <span class="s">"Spade"</span><span class="o">;</span>
  <span class="o">};</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que le compilateur lève l&#8217;erreur :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>|  Error:
|  different case kinds used in the switch
|                  case CARREAU -&gt; "diamond";
|                  ^------------------------^</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="records"><a class="anchor" href="#records"></a>4.2.2. Lab : les Records</h4>
<div class="paragraph">
<p>La création d&#8217;une classe immuable est un besoin fréquent en Java.
Une façon de répondre à ce besoin est de créer une classe dont les attributs sont <code>final</code>, d&#8217;écrire un constructeur permettant d&#8217;initialiser leurs valeurs et de définir des accesseurs.
On peut aussi avoir besoin d&#8217;une implémentation des méthodes <code>toString()</code>, ainsi qu'<code>hashcode()</code> et <code>equals()</code>, que l&#8217;on peut générer avec son IDE.</p>
</div>
<div class="paragraph">
<p>Ceci est très verbeux et potentiellement source d&#8217;erreur, pour un besoin simple de représentation de données immuables.</p>
</div>
<div class="paragraph">
<p>Les Records ont été ajoutés au langage afin de faciliter cette tâche.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JDK</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Première preview en Java 14 <a href="https://openjdk.org/jeps/359">JEP 359</a>. Standard en Java 16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JEP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openjdk.org/jeps/395">395: Records</a></p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_la_syntaxe"><a class="anchor" href="#_la_syntaxe"></a>4.2.2.1. La syntaxe</h5>
<div class="paragraph">
<p>Un nouveau type <code>record</code> fait son apparition et est défini via l&#8217;emploi du mot clé contextuel <code>record</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la classe <code>fr.sciam.workshop.javase.records.Point</code> pour la convertir en un record, via la syntaxe :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="n">record</span> <span class="nf">Point</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Cette déclaration crée pour nous les éléments suivants :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>une classe immuable avec deux composants <code>x</code> et <code>y</code> de type <code>int</code> qui sont <code>final</code>,</p>
</li>
<li>
<p>un constructeur canonique pour initialiser leurs valeurs,</p>
</li>
<li>
<p>des accesseurs <code>x()</code> et <code>y()</code></p>
</li>
<li>
<p>une implémentation des méthodes <code>toString()</code>, <code>hashcode()</code> et <code>equals()</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Dans le cas d&#8217;un record, on parle de "composants" pour <code>x</code> et <code>y</code> et non de champs ou d&#8217;attributs.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Les accesseurs ne respectent pas la convention JavaBeans. Ils ne sont pas préfixés par "get" (ni "is" pour les booléens), ils reprennent exactement le nom du composant correspondant.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>afficherPoint()</code> de la classe <code>fr.sciam.workshop.javase.records.MainRecord</code> pour créer une nouvelle instance de <code>Point</code> en invoquant son constructeur canonique puis l&#8217;afficher.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afficherPoint</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Point</span> <span class="n">point</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Point</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">point</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter le programme et constater qu&#8217;il affiche :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Afficher point
Point[x=1, y=2]</pre>
</div>
</div>
<div class="paragraph">
<p>Il s&#8217;agit du résultat de l&#8217;appel à la méthode <code>toString()</code> qui a été générée pour nous.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>La méthode <code>toString()</code> générée affiche le nom du record ainsi que les valeurs de ses composants.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Dans la méthode <code>afficherEgalite()</code>, créer 3 instances de <code>Point</code> et tester leur égalité :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">testerEgalites</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Point</span> <span class="n">p1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Point</span><span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">);</span>
    <span class="nc">Point</span> <span class="n">p2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Point</span><span class="o">(</span><span class="mi">11</span><span class="o">,</span> <span class="mi">9</span><span class="o">);</span>
    <span class="nc">Point</span> <span class="n">p3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Point</span><span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">);</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">p1</span> <span class="o">+</span> <span class="s">" equals "</span> <span class="o">+</span> <span class="n">p2</span> <span class="o">+</span> <span class="s">" : "</span> <span class="o">+</span> <span class="n">p1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">p2</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">p1</span> <span class="o">+</span> <span class="s">" equals "</span> <span class="o">+</span> <span class="n">p3</span> <span class="o">+</span> <span class="s">" : "</span> <span class="o">+</span> <span class="n">p1</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">p3</span><span class="o">));</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que la première égalité est fausse, tandis que la seconde est vraie.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Tester égalités
Point[x=7, y=8] equals Point[x=11, y=9] : false
Point[x=7, y=8] equals Point[x=7, y=8] : true</pre>
</div>
</div>
<div class="paragraph">
<p>Une implémentation de la méthode <code>equals()</code> a été générée, se basant sur l&#8217;égalité de ses composants.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Il est possible d&#8217;ajouter des méthodes au sein d&#8217;un record, aussi bien statiques que d&#8217;instances.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Dans le record <code>Point</code>, ajouter deux méthodes <code>calculerDistance()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">public</span> <span class="kt">double</span> <span class="nf">calculerDistance</span><span class="o">(</span><span class="nc">Point</span> <span class="n">point</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="na">x</span><span class="o">()</span> <span class="o">-</span> <span class="k">this</span><span class="o">.</span><span class="na">x</span><span class="o">;</span>
    <span class="kt">int</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">point</span><span class="o">.</span><span class="na">y</span><span class="o">()</span> <span class="o">-</span> <span class="k">this</span><span class="o">.</span><span class="na">y</span><span class="o">;</span>

    <span class="k">return</span> <span class="nc">Math</span><span class="o">.</span><span class="na">hypot</span><span class="o">(</span><span class="n">dx</span><span class="o">,</span> <span class="n">dy</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">double</span> <span class="nf">calculerDistance</span><span class="o">(</span><span class="nc">Point</span> <span class="n">point1</span><span class="o">,</span> <span class="nc">Point</span> <span class="n">point2</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">point1</span><span class="o">.</span><span class="na">calculerDistance</span><span class="o">(</span><span class="n">point2</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que la syntaxe est valide : aussi bien pour l&#8217;ajout de la méthode que la présence des accesseurs <code>x()</code> et <code>y()</code>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Il est également possible d&#8217;implémenter des interfaces.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier <code>Point</code> afin qu&#8217;il implémente l&#8217;interface <code>Comparable&lt;Point&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="n">record</span> <span class="nf">Point</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="kd">implements</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="nc">Point</span><span class="o">&gt;</span> <span class="o">{</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="nc">Point</span> <span class="n">point</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">xc</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">x</span><span class="o">,</span> <span class="n">point</span><span class="o">.</span><span class="na">x</span><span class="o">());</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">xc</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">xc</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">compare</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">y</span><span class="o">,</span> <span class="n">point</span><span class="o">.</span><span class="na">y</span><span class="o">());</span>
    <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Modifier la méthode <code>comparerPoint()</code> de <code>MainRecord</code> afin de comparer deux points :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">comparerPoint</span><span class="o">()</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">comparaison</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Point</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(</span><span class="k">new</span> <span class="nc">Point</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">));</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Comparaison : "</span> <span class="o">+</span> <span class="n">comparaison</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter le programme et vérifier qu&#8217;il affiche :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Comparer point
Comparaison : 1</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_les_limitations"><a class="anchor" href="#_les_limitations"></a>4.2.2.2. Les limitations</h5>
<div class="paragraph">
<p>Plusieurs limitations s&#8217;appliquent aux records :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>il n&#8217;est pas possible pour un record d&#8217;étendre une classe : un record hérite déjà de la classe <code>java.lang.Record</code>,</p>
</li>
<li>
<p>il n&#8217;est pas non plus possible d&#8217;étendre un record, car il est <code>final</code>. Il ne pourra contenir que des méthodes concrètes,</p>
</li>
<li>
<p>il n&#8217;est pas possible de définir un bloc d&#8217;initialisation (<code>{ &#8230;&#8203; }</code> dans le corps du record)</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br></p>
</div>
<div class="paragraph">
<p>Créer un nouveau record <code>PointInvalide</code> de la manière suivante :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><table class="linenotable"><tbody><tr><td class="linenos gl"><pre class="lineno"> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
</pre></td><td class="code"><pre><span class="kn">import</span> <span class="nn">java.awt.Dimension</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>

<span class="kd">public</span> <span class="n">record</span> <span class="nf">PointInvalide</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span>
    <span class="kd">extends</span> <span class="nc">Dimension</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>

    <span class="kt">int</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="o">{</span> <i class="conum" data-value="3"></i><b>(3)</b>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que des erreurs sont levées au niveau des puces 1, 2 et 3, puis supprimer ce record.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Créer la classe <code>Point3D</code> qui étend le record <code>Point</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Point3D</span> <span class="kd">extends</span> <span class="nc">Point</span> <span class="o">{</span>

    <span class="kt">int</span> <span class="n">z</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Point3D</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">,</span> <span class="kt">int</span> <span class="n">z</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="n">y</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que l&#8217;on obtient l&#8217;erreur de compilation :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Cannot inherit from final 'fr.sciam.workshop.javase.records.Point'</pre>
</div>
</div>
<div class="paragraph">
<p>Supprimer cette classe invalide.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_les_constructeurs"><a class="anchor" href="#_les_constructeurs"></a>4.2.2.3. Les constructeurs</h5>
<div class="paragraph">
<p>Le constructeur canonique est automatiquement généré.
Il peut être utile de redéfinir le constructeur canonique pour par exemple procéder à des contrôles au sein de ce dernier. Les records proposent une syntaxe simplifiée dénommée "constructeur compact".
Ce constructeur compact ne déclare pas les paramètres dans sa syntaxe : ils seront automatiquement ajoutés par le compilateur.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Ajouter un constructeur compact qui vérifie que les valeurs de <code>x</code> et <code>y</code> sont comprises entre -100 et 100.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="nc">Point</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="nc">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">x</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="o">||</span> <span class="nc">Math</span><span class="o">.</span><span class="na">abs</span><span class="o">(</span><span class="n">y</span><span class="o">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Les valeurs de x et y doivent être comprises entre -100 et 100"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Dans <code>MainRecord</code>, modifier la méthode <code>utiliserConstructeurAvecControles()</code> pour tenter de créer une instance de <code>Point</code>, puis exécuter le programme.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">utiliserConstructeurAvecControles</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Point</span> <span class="n">ptInvalide</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Point</span><span class="o">(</span><span class="mi">150</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ptInvalide</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que le code de contrôle est bien exécuté :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Constructeur avec contrôles
Exception in thread "main" java.lang.IllegalArgumentException: Les valeurs de x et y doivent être comprises entre -100 et 100</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Il est également possible d&#8217;affecter une valeur modifiée aux composants du record dans son constructeur.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Réécrire le code du constructeur compact pour forcer les valeurs de <code>x</code> et <code>y</code> entre -100 et 100 grâce à la méthode <code>Math::clamp</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
La méthode <code>Math::clamp</code> a été ajoutée dans le JDK 21, son rôle est de contraindre la valeur passée en premier paramètre entre une borne min et une borne max.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="nc">Point</span> <span class="o">{</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">clamp</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="o">-</span><span class="mi">100</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
    <span class="n">y</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">clamp</span><span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="o">-</span><span class="mi">100</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter à nouveau <code>MainRecord</code> et constater que le programme affiche :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Constructeur avec contrôles
Point[x=100, y=0]</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Il n&#8217;est pas possible de préfixer les composants par <code>this</code> dans les surcharges de constructeur.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Il est possible de fournir des surcharges de constructeur, pourvu que l&#8217;appel au constructeur canonique soit effectué.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br></p>
</div>
<div class="paragraph">
<p>Ajouter un constructeur qui prend un seul entier en paramètre et qui affecte cette valeur à <code>x</code> et <code>y</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="nf">Point</span><span class="o">(</span><span class="kt">int</span> <span class="n">xy</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">this</span><span class="o">(</span><span class="n">xy</span><span class="o">,</span> <span class="n">xy</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Dans <code>MainRecord</code>, modifier la méthode <code>utiliserAutreConstructeur</code> pour utiliser ce constructeur.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">utiliserAutreConstructeur</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Point</span> <span class="n">ptIdent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Point</span><span class="o">(-</span><span class="mi">20</span><span class="o">);</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">ptIdent</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter le programme et constater qu&#8217;il affiche :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Autre constructeur
Point[x=-20, y=-20]</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Il n&#8217;est pas obligatoire que soit directement appelé le constructeur canonique. Un autre constructeur peut être appelé, mais à la fin de la chaîne d&#8217;appels le constructeur canonique doit être appelé.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_les_records_locaux"><a class="anchor" href="#_les_records_locaux"></a>4.2.2.4. Les records locaux</h5>
<div class="paragraph">
<p>Il est possible de définir un record local. Cela peut être utile pour définir une structure de données, éventuellement des comportements, pour un besoin local à une méthode.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>utiliserRecordLocal()</code> de <code>MainRecord</code> afin de déclarer et utiliser un record local. Puis exécuter le programme.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">utiliserRecordLocal</span><span class="o">()</span> <span class="o">{</span>

    <span class="n">record</span> <span class="nf">PointNomme</span><span class="o">(</span><span class="nc">String</span> <span class="n">nom</span><span class="o">,</span> <span class="nc">Point</span> <span class="n">p</span><span class="o">)</span> <span class="o">{}</span>

    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">PointNomme</span><span class="o">&gt;</span> <span class="n">points</span> <span class="o">=</span> <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span>
      <span class="k">new</span> <span class="nf">PointNomme</span><span class="o">(</span><span class="s">"Alpha"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Point</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">)),</span>
      <span class="k">new</span> <span class="nf">PointNomme</span><span class="o">(</span><span class="s">"Beta"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Point</span><span class="o">(-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">)),</span>
      <span class="k">new</span> <span class="nf">PointNomme</span><span class="o">(</span><span class="s">"Gamma"</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Point</span><span class="o">(</span><span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">))</span>
    <span class="o">);</span>

    <span class="n">points</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vérifier que le code compile et que l&#8217;on affiche :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Record local
PointNomme[nom=Alpha, p=Point[x=0, y=0]]
PointNomme[nom=Beta, p=Point[x=-1, y=1]]
PointNomme[nom=Gamma, p=Point[x=7, y=8]]</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_la_sérialisation"><a class="anchor" href="#_la_sérialisation"></a>4.2.2.5. La sérialisation</h5>
<div class="paragraph">
<p>Un record peut être sérialisé s&#8217;il implémente l&#8217;interface <code>Serializable</code>.
Contrairement aux classes standard, certaines règles spécifiques lui sont appliquées.
Il n&#8217;est pas possible de définir des comportements particuliers lors de la sérialisation, par exemple par le biais des méthodes <code>writeObject()</code> ou <code>readObject()</code> ou par l&#8217;implémentation de l&#8217;interface <code>Externalisable</code>.
Lors du processus de désérialisation, le constructeur canonique est toujours appelé.
Cela apporte l&#8217;assurance que les éventuels contrôles implémentés sont exécutés.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier le record <code>Point</code> en commentant son constructeur compact et le rendre sérialisable en lui faisant implémenter l&#8217;interface <code>Serializable</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="n">record</span> <span class="nf">Point</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span><span class="o">,</span> <span class="kt">int</span> <span class="n">y</span><span class="o">)</span> <span class="kd">implements</span> <span class="nc">Serializable</span><span class="o">,</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="nc">Point</span><span class="o">&gt;</span> <span class="o">{</span>
<span class="c1">//    public Point {</span>
<span class="c1">//        x = Math.clamp(x, -100, 100);</span>
<span class="c1">//        y = Math.clamp(y, -100, 100);</span>
<span class="c1">//    }</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ajouter également une implémentation des méthodes <code>readObject()</code> et <code>writeObject()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">readObject</span><span class="o">(</span><span class="nc">ObjectInputStream</span> <span class="n">stream</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ClassNotFoundException</span> <span class="o">{</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Point.readObject()"</span><span class="o">);</span>
  <span class="o">}</span>

  <span class="kd">private</span> <span class="kt">void</span> <span class="nf">writeObject</span><span class="o">(</span><span class="nc">ObjectOutputStream</span> <span class="n">stream</span><span class="o">)</span>
    <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>

      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Point.writeObject()"</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Dans la méthode <code>serialiserPoint()</code> de <code>MainRecord</code>, ajouter le code suivant pour sérialiser une instance de <code>Point</code> dans un fichier, puis exécuter le programme.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">serialiserPoint</span><span class="o">()</span> <span class="o">{</span>

  <span class="nc">Point</span> <span class="n">point</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Point</span><span class="o">(-</span><span class="mi">4096</span><span class="o">,</span> <span class="mi">4096</span><span class="o">);</span>

  <span class="k">try</span> <span class="o">(</span><span class="nc">FileOutputStream</span> <span class="n">fileOutputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="no">FILE</span><span class="o">);</span>
    <span class="nc">ObjectOutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectOutputStream</span><span class="o">(</span><span class="n">fileOutputStream</span><span class="o">))</span> <span class="o">{</span>

    <span class="n">out</span><span class="o">.</span><span class="na">writeObject</span><span class="o">(</span><span class="n">point</span><span class="o">);</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Point "</span> <span class="o">+</span> <span class="n">point</span> <span class="o">+</span> <span class="s">" sérialisé dans "</span> <span class="o">+</span> <span class="no">FILE</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>

  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vérifier que le fichier <code>point.bin</code> a été créé.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Sérialiser
Point Point[x=-4096, y=4096] sérialisé dans "C:\workshop\point.bin"</pre>
</div>
</div>
<div class="paragraph">
<p>Afficher son contenu avec la commande <code>more</code> par exemple ou l&#8217;ouvrir avec un éditeur de texte pour constater qu&#8217;il contient des données binaires, dont le nom pleinement qualifié du record en toutes lettres : <code>fr.sciam.workshop.javase.records.Point</code>.</p>
</div>
<div class="paragraph">
<p>Constater également que la méthode <code>writeObject()</code> n&#8217;a pas été invoquée : le texte "Point.writeObject()" n&#8217;a pas été affiché.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Vérifions le processus de désérialisation.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br></p>
</div>
<div class="paragraph">
<p>Modifier la méthode <code>deserialiserPoint()</code> de <code>MainRecord</code> afin de désérialiser l&#8217;instance de <code>Point</code> à partir du fichier précédemment créé.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">deserialiserPoint</span><span class="o">()</span> <span class="o">{</span>
  <span class="k">try</span> <span class="o">(</span><span class="nc">FileInputStream</span> <span class="n">fileInputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="no">FILE</span><span class="o">))</span> <span class="o">{</span>

    <span class="nc">ObjectInputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectInputStream</span><span class="o">(</span><span class="n">fileInputStream</span><span class="o">);</span>

    <span class="nc">Point</span> <span class="n">point</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Point</span><span class="o">)</span> <span class="n">in</span><span class="o">.</span><span class="na">readObject</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Point lu dans le fichier : "</span> <span class="o">+</span> <span class="n">point</span><span class="o">);</span>

  <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="o">|</span> <span class="nc">ClassNotFoundException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que le programme affiche :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Désérialiser
Point lu dans le fichier : Point[x=-4096, y=4096]</pre>
</div>
</div>
<div class="paragraph">
<p>Constater également que la méthode <code>readObject()</code> n&#8217;a pas été invoquée : le texte "Point.readObject()" n&#8217;a pas été affiché.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Enfin, vérifions que le constructeur est bel et bien invoqué lors du processus de désérialisation.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br></p>
</div>
<div class="paragraph">
<p>De-commenter le constructeur compact de <code>Point</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="nc">Point</span> <span class="o">{</span>
  <span class="n">x</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">clamp</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="o">-</span><span class="mi">100</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
  <span class="n">y</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">clamp</span><span class="o">(</span><span class="n">y</span><span class="o">,</span> <span class="o">-</span><span class="mi">100</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Puis commenter dans la méthode <code>main()</code> de <code>MainRecord</code> l&#8217;appel de la sérialization, en laissant la désérialisation :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Sérialiser"</span><span class="o">);</span>
<span class="c1">//    serialiserPoint();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Désérialiser"</span><span class="o">);</span>
    <span class="n">deserialiserPoint</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Enfin, exécuter le programme <code>MainRecord</code> et constater qu&#8217;il affiche :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Point lu dans le fichier : Point[x=-100, y=100]</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Le constructeur a été invoqué lors du processus de désérialisation, garantissant l&#8217;exécution de nos contrôles et traitements.</p>
</div>
</div>
<div class="sect4">
<h5 id="_les_records_et_lapi_reflection"><a class="anchor" href="#_les_records_et_lapi_reflection"></a>4.2.2.6. Les records et l&#8217;API Reflection</h5>
<div class="paragraph">
<p>Le type <code>Class</code> se voit enrichi de nouvelles méthodes dédiées aux records :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>isRecord()</code> permet de savoir si le type est un record,</p>
</li>
<li>
<p><code>getRecordComponents()</code> renvoie un tableau de <code>RecordComponent</code> permettant d&#8217;introspecter les composants du record, ou <code>null</code> si le type n&#8217;est pas un record.</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>instrospecterPoint()</code> de <code>MainRecord</code>, en y ajoutant le code suivant :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kt">boolean</span> <span class="n">estRecord</span> <span class="o">=</span> <span class="nc">Point</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isRecord</span><span class="o">();</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Point est un record : "</span> <span class="o">+</span> <span class="n">estRecord</span><span class="o">);</span>

<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Composants :"</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="nc">RecordComponent</span> <span class="n">rc</span> <span class="o">:</span> <span class="nc">Point</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getRecordComponents</span><span class="o">())</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"\t"</span> <span class="o">+</span> <span class="n">rc</span><span class="o">.</span><span class="na">getName</span><span class="o">()</span> <span class="o">+</span> <span class="s">", type : "</span> <span class="o">+</span> <span class="n">rc</span><span class="o">.</span><span class="na">getType</span><span class="o">());</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter le programme puis constater qu&#8217;il affiche :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Introspecter
Point est un record : true
Composants :
	x, type : int
	y, type : int</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="classes-scellees"><a class="anchor" href="#classes-scellees"></a>4.2.3. Lab : les classes scellées</h4>
<div class="paragraph">
<p>Le concept de classes et interfaces scellées permet de restreindre les classes et interfaces qui peuvent les étendre ou les implémenter.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JDK</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Première preview en Java 15 <a href="https://openjdk.org/jeps/360">JEP 360</a>. Standard en Java 17</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JEP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openjdk.org/jeps/409">409: Sealed Classes</a></p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_la_définition_dune_hiérarchie_de_classes_scellées"><a class="anchor" href="#_la_définition_dune_hiérarchie_de_classes_scellées"></a>4.2.3.1. La définition d&#8217;une hiérarchie de classes scellées</h5>
<div class="paragraph">
<p>Un nouveau modificateur fait son apparition : <code>sealed</code>. En conjonction avec la clause <code>permits</code>, il est possible de restreindre la liste des classes ou interfaces que peuvent étendre ou implémenter une classe ou une interface.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la classe <code>fr.sciam.workshop.javase.sealedclasses.Ingredient</code> pour la rendre scellée en y ajoutant le modificateur <code>sealed</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Ingredient</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que le code est en erreur :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Error: sealed class must have subclasses</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Une classe scellée doit définir explicitement la liste des classes qui l&#8217;étendent en utilisant une clause <code>permits</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier à nouveau la classe <code>Ingredient</code> pour lui spécifier que désormais ses seules sous-classes permises sont :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>Malt</code></p>
</li>
<li>
<p><code>Houblon</code></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Ingredient</span> <span class="n">permits</span> <span class="nc">Houblon</span><span class="o">,</span> <span class="nc">Malt</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que la classe <code>Ingredient</code> affiche l&#8217;erreur :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>All sealed class subclasses must either be final, sealed or non-sealed</pre>
</div>
</div>
<div class="paragraph">
<p>Et que chaque classe de la clause <code>permits</code> est en erreur :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Error: sealed, non-sealed or final modifiers expected</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Il est nécessaire que la hiérarchie permise précise comment le scellement initié par la classe mère se propage en utilisant un des trois modificateurs : <code>final</code>, <code>sealed</code> ou <code>non-sealed</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Ajouter le modificateur <code>final</code> sur chacune des sous-classes afin de sceller complètement la hiérarchie.</p>
</div>
<div class="listingblock">
<div class="title">Malt.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Malt</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Houblon.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Houblon</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>À ce stade, seules les classes <code>Malt</code> et <code>Houblon</code> peuvent étendre <code>Ingredient</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Ajouter une nouvelle classe <code>Eau</code> qui étend <code>Ingredient</code></p>
</div>
<div class="listingblock">
<div class="title">Eau.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Eau</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que nous obtenons une erreur de compilation :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>'Eau' is not allowed in the sealed hierarchy</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>A ce stade, la classe <code>Ingredient</code> ne permet pas d&#8217;être étendue par cette classe <code>Eau</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Rendre la classe <code>Eau</code> <code>final</code> et l&#8217;ajouter à la liste des sous-classes permises par <code>Ingredient</code>.</p>
</div>
<div class="listingblock">
<div class="title">Eau.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Eau</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ingredient.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Ingredient</span> <span class="n">permits</span> <span class="nc">Eau</span><span class="o">,</span> <span class="nc">Malt</span><span class="o">,</span> <span class="nc">Houblon</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que la hiérarchie est à nouveau cohérente et le code compile.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Il est également possible de rendre ouverte pour extension une partie de la hiérarchie. Pour cela, le modificateur <code>non-sealed</code> a été ajouté au langage. Son utilisation permet ainsi une certaine souplesse sur la définition de la hiérarchie en permettant à une sous-partie seulement d&#8217;être étendue librement.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>non-sealed</code> est le premier mot clé contenant un trait d&#8217;union introduit dans le langage Java.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Ajouter la classe abstraite <code>Levure</code> comme sous-classe non-scellée de <code>Ingredient</code>, ainsi que la classe <code>LevureHaute</code> comme sous-classe <code>final</code> de <code>Levure</code>.
Les déclarer dans la clause <code>permits</code> de <code>Ingredient</code>.</p>
</div>
<div class="listingblock">
<div class="title">Levure.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="n">non</span><span class="o">-</span><span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Levure</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">LevureHaute.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">LevureHaute</span> <span class="kd">extends</span> <span class="nc">Levure</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ingredient.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Ingredient</span> <span class="n">permits</span> <span class="nc">Eau</span><span class="o">,</span> <span class="nc">Malt</span><span class="o">,</span> <span class="nc">Houblon</span><span class="o">,</span> <span class="nc">Levure</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que la branche <code>Levure</code> de la hiérarchie est belle et bien à nouveau ouverte pour extension. Il est possible d&#8217;ajouter librement des sous-classes de <code>Levure</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Il n&#8217;a pas été nécessaire d&#8217;ajouter <code>LevureHaute</code> dans la clause <code>permits</code> : cela aurait d&#8217;ailleurs été une erreur puisque seules les sous-classes directes sont déclarées.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Il est possible de répéter ce schéma récursivement dans la hiérarchie fille, en y ajoutant des branches scellées tout comme non-scellées.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Les classes filles permises doivent être "proches" de la super-classe, c&#8217;est-à-dire :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>dans le même module si la super-classe est dans un module nommé,</p>
</li>
<li>
<p>ou bien dans le même package si la super-classe est dans un module "unnamed".</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Jusqu&#8217;à présent, chaque sous-classe a été déclarée dans son propre fichier, ce qui constitue un choix judicieux pour bon nombre d&#8217;applications. Dans certains cas de figure, il peut être fait le choix de regrouper les classes au sein du même fichier .java.</p>
</div>
<div class="paragraph">
<p>Dans ce cas d&#8217;usage précis, il est possible de retirer la clause <code>permits</code> : le compilateur s&#8217;en chargera pour nous.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Déplacer les sous-classes créées jusqu&#8217;à présent au sein du fichier Ingredient.java puis retirer la clause <code>permits</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Ingredient</span> <span class="o">{</span>
<span class="o">}</span>

<span class="kd">final</span> <span class="kd">class</span> <span class="nc">Eau</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="nc">Malt</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="nc">Houblon</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
<span class="kd">abstract</span> <span class="n">non</span><span class="o">-</span><span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Levure</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
<span class="kd">final</span> <span class="kd">class</span> <span class="nc">LevureHaute</span> <span class="kd">extends</span> <span class="nc">Levure</span> <span class="o">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que cette syntaxe est valide et que le code compile.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Il est aussi possible de convertir ces classes en classes internes de <code>Ingredient</code>, sans avoir à définir la clause <code>permits</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Convertir les sous-classes en classes internes de <code>Ingredient</code> en les déplaçant dans le corps de la classe.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Ingredient</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Eau</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Malt</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Houblon</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
  <span class="kd">abstract</span> <span class="n">non</span><span class="o">-</span><span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Levure</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">LevureHaute</span> <span class="kd">extends</span> <span class="nc">Levure</span> <span class="o">{}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que cette syntaxe est valide et que le code compile.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Nous avons jusqu&#8217;à présent manipulé une hiérarchie de classes, mais il est tout aussi possible de définir des interfaces scellées de manière analogue.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Créer une interface scellée <code>ElementBrassage</code> dont l&#8217;implémentation possible est <code>Ingredient</code> puis modifier la classe <code>Ingredient</code> afin qu&#8217;elle l&#8217;implémente.</p>
</div>
<div class="listingblock">
<div class="title">ElementBrassage.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="n">sealed</span> <span class="kd">interface</span> <span class="nc">ElementBrassage</span> <span class="n">permits</span> <span class="nc">Ingredient</span> <span class="o">{</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Ingredient.java</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Ingredient</span> <span class="kd">implements</span> <span class="nc">ElementBrassage</span> <span class="o">{</span>
  <span class="c1">// Reste du code</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que cette nouvelle hiérarchie est valide : le code compile avec succès.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_les_classes_scellées_et_la_réflexion"><a class="anchor" href="#_les_classes_scellées_et_la_réflexion"></a>4.2.3.2. Les classes scellées et la réflexion</h5>
<div class="paragraph">
<p>La classe <code>java.lang.Class</code> se voit enrichie de nouvelles méthodes propres aux classes scellées :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>isSealed()</code> : indique si la classe est scellée ou non</p>
</li>
<li>
<p><code>getPermittedSubclasses()</code> : renvoie la liste des sous-interfaces ou sous-classes qui implémentent directement la classe, si elle est scellée</p>
</li>
</ul>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Dans la méthode <code>afficherReflexion()</code> de la classe <code>fr.sciam.workshop.javase.sealedclasses.MainBrassage</code>, utiliser ces APIs afin d&#8217;obtenir des informations sur <code>Ingredient</code> et sa hiérarchie par réflexion. Puis exécuter le programme afin d&#8217;afficher ces informations.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afficherReflexion</span><span class="o">()</span> <span class="o">{</span>

  <span class="kt">boolean</span> <span class="n">scellee</span> <span class="o">=</span> <span class="nc">Ingredient</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isSealed</span><span class="o">();</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"La classe Ingredient est scellée : "</span> <span class="o">+</span> <span class="n">scellee</span><span class="o">);</span>

  <span class="k">if</span> <span class="o">(</span><span class="n">scellee</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Sous classes permises :"</span><span class="o">);</span>
    <span class="nc">Class</span><span class="o">&lt;?&gt;[]</span> <span class="n">sousClassesPermises</span> <span class="o">=</span> <span class="nc">Ingredient</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getPermittedSubclasses</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">cls</span> <span class="o">:</span> <span class="n">sousClassesPermises</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"  "</span> <span class="o">+</span> <span class="n">cls</span><span class="o">.</span><span class="na">getSimpleName</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span>

  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainBrassage</code> et vérifie que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Afficher réflexion
La classe Ingredient est scellée : true
Sous classes permises :
  Eau
  Malt
  Houblon
  Levure</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_les_classes_scellées_et_le_pattern_matching"><a class="anchor" href="#_les_classes_scellées_et_le_pattern_matching"></a>4.2.3.3. les classes scellées et le pattern matching</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Ce chapitre fait intervenir le concept de Pattern Matching for switch, qui fait l&#8217;objet du lab <a href="partie1.html#pattern-matching-switch">Pattern Matching for switch</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>La définition d&#8217;une hiérarchie de types scellés permet d&#8217;utiliser l&#8217;instruction <code>switch</code> en bénéficiant de la couverture de l&#8217;exhaustivité des branches.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la hiérarchie de <code>Ingredient</code> pour que seules <code>Eau</code>, <code>Malt</code>, <code>Houblon</code> et <code>Levure</code> soient permises. Rendre également <code>Ingredient</code> abstraite.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="n">sealed</span> <span class="kd">class</span> <span class="nc">Ingredient</span> <span class="kd">implements</span> <span class="nc">ElementBrassage</span> <span class="o">{</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Eau</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Malt</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Houblon</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Levure</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Ainsi, toute instance de <code>Ingredient</code> est forcément du type de l&#8217;une des quatre classes : <code>Eau</code>, <code>Malt</code>, <code>Houblon</code> ou <code>Levure</code>.</p>
</div>
<div class="paragraph">
<p>Modifier la classe <code>Ingredient</code> en y ajoutant la méthode <code>estFermentescible()</code> qui renvoie <code>true</code> si l&#8217;ingrédient fourni en paramètre est de type <code>Malt</code>, en utilisant une expression <code>switch</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">estFermentescible</span><span class="o">(</span><span class="nc">Ingredient</span> <span class="n">ingredient</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">ingredient</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Eau</span> <span class="n">eau</span> <span class="o">-&gt;</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Malt</span> <span class="n">malt</span> <span class="o">-&gt;</span> <span class="kc">true</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Houblon</span> <span class="n">houblon</span> <span class="o">-&gt;</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Levure</span> <span class="n">levure</span> <span class="o">-&gt;</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">};</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>On note qu&#8217;il n&#8217;est pas nécessaire de définir le cas <code>default</code> : l&#8217;exhaustivité des cas est assurée.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Ceci offre un certain avantage en apportant de la robustesse à notre code.</p>
</div>
<div class="paragraph">
<p>Pour illustrer cela, ajouter un nouveau type d&#8217;ingrédient et voyons l&#8217;impact sur notre code.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Ajouter un nouvel ingrédient au travers de la classe <code>Sucre</code> qui hérite de la classe <code>Ingredient</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Eau</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Malt</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Houblon</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Levure</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span>
  <span class="kd">final</span> <span class="kd">class</span> <span class="nc">Sucre</span> <span class="kd">extends</span> <span class="nc">Ingredient</span> <span class="o">{}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que la méthode <code>estFermentescible</code> est désormais en erreur :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Error : 'switch' expression does not cover all possible input values</pre>
</div>
</div>
<div class="paragraph">
<p>En effet, l&#8217;expression <code>switch</code> ne couvre plus tous les cas possibles.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Le fait d&#8217;avoir une erreur dès la compilation plutôt qu&#8217;au runtime nous permet de détecter et traiter en amont les impacts sur notre application plutôt que de les découvrir potentiellement tardivement.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ajouter le cas manquant dans le bloc <code>switch</code>, pour lequel il faut renvoyer <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">estFermentescible</span><span class="o">(</span><span class="nc">Ingredient</span> <span class="n">ingredient</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nf">switch</span> <span class="o">(</span><span class="n">ingredient</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Eau</span> <span class="n">eau</span> <span class="o">-&gt;</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Malt</span> <span class="n">malt</span> <span class="o">-&gt;</span> <span class="kc">true</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Houblon</span> <span class="n">houblon</span> <span class="o">-&gt;</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Levure</span> <span class="n">levure</span> <span class="o">-&gt;</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Sucre</span> <span class="n">sucre</span> <span class="o">-&gt;</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">};</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que notre code est à nouveau valide : l&#8217;exhaustivité des cas est couverte.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_les_vérifications_faites_par_la_jvm_au_runtime_optionnel"><a class="anchor" href="#_les_vérifications_faites_par_la_jvm_au_runtime_optionnel"></a>4.2.3.4. Les vérifications faites par la JVM au runtime [Optionnel]</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Cette dernière partie présente des concepts avancés et revêt un caractère facultatif.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Nous avons pu voir que le compilateur effectue les vérifications nécessaires, afin de garantir l&#8217;intégrité de la hiérarchie. Que se passe-t-il au runtime si l&#8217;on essaie de créer dynamiquement une instance de <code>Ingredient</code> en ayant recours à un <code>Proxy</code> ?</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Compléter la méthode <code>creerProxy()</code> dans la classe <code>MainBrassage`pour ajouter la création d&#8217;un proxy dynamique sur l&#8217;interface `ElementBrassage</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">creerProxy</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Object</span> <span class="n">proxyInstance</span> <span class="o">=</span> <span class="nc">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span>
      <span class="nc">ElementBrassage</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getClassLoader</span><span class="o">(),</span>
      <span class="k">new</span> <span class="nc">Class</span><span class="o">[]</span> <span class="o">{</span> <span class="nc">ElementBrassage</span><span class="o">.</span><span class="na">class</span> <span class="o">},</span>
      <span class="o">(</span><span class="n">proxy</span><span class="o">,</span> <span class="n">method</span><span class="o">,</span> <span class="n">params</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="kc">null</span>
    <span class="o">);</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Le type est "</span> <span class="o">+</span> <span class="n">proxyInstance</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">());</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter le programme et constater qu&#8217;une exception de type <code>IllegalArgumentException</code> est levée.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Exception in thread "main" java.lang.IllegalArgumentException: fr.sciam.workshop.javase.sealedclasses.ElementBrassage is a sealed interface</pre>
</div>
</div>
<div class="paragraph">
<p>La JVM procède donc aux contrôles au runtime, garantissant ainsi l&#8217;intégrité de notre hiérarchie à tout moment.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_le_pattern_matching"><a class="anchor" href="#_le_pattern_matching"></a>4.3. Le Pattern matching</h3>
<div class="paragraph">
<p>Plusieurs évolutions de la syntaxe concernent la mise en œuvre du pattern matching.</p>
</div>
<div class="sect3">
<h4 id="pattern-matching-for-instanceof"><a class="anchor" href="#pattern-matching-for-instanceof"></a>4.3.1. Lab : le Pattern Matching for instanceof</h4>
<div class="paragraph">
<p>Historiquement, l&#8217;opérateur <code>instanceof</code> permet de vérifier le type d&#8217;une variable avant de pouvoir l&#8217;utiliser. Si l&#8217;opérateur renvoie <code>true</code> alors il est nécessaire de faire un cast vers une autre variable du type testé.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Consulter la méthode <code>afficherConges()</code> de la classe <code>fr.sciam.workshop.javase.patternmatchinginstanceof.MainPatternMatchingInstanceof</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afficherConges</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">Employe</span><span class="o">)</span> <span class="o">{</span>
      <span class="nc">Employe</span> <span class="n">employe</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Employe</span><span class="o">)</span> <span class="n">obj</span><span class="o">;</span>
      <span class="kt">var</span> <span class="n">conges</span> <span class="o">=</span> <span class="n">employe</span><span class="o">.</span><span class="na">conges</span><span class="o">();</span>
      <span class="n">conges</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainPatternMatchingInstanceof</code> pour vérifier l&#8217;affichage.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Congés du 15 mars 2024 au 22 mars 2024
Congés du 1 août 2024 au 21 août 2024</pre>
</div>
</div>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JDK</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Première preview en Java 14 (<a href="https://openjdk.org/jeps/305">JEP 305</a>). Standard en Java 16</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JEP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openjdk.org/jeps/394">394: Pattern Matching for instanceof</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Le concept de pattern matching existe déjà dans de nombreux langages. Le but est de permettre d&#8217;utiliser le pattern matching avec l&#8217;opérateur <code>instanceof</code>.</p>
</div>
<div class="paragraph">
<p>Le pattern matching permet de simplifier l&#8217;utilisation de l&#8217;opérateur <code>instanceof</code>.
La syntaxe est simple : il suffit de faire suivre l&#8217;opérateur instanceof d&#8217;un pattern. Le premier pattern proposé est le type pattern qui syntaxiquement est composé d&#8217;un type suivi d&#8217;un nom de variable de pattern.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>afficherConges()</code> de la classe <code>MainPatternMatchingInstanceof</code> pour utiliser un pattern de type dans l&#8217;opérateur <code>instanceof</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afficherConges</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">Employe</span> <span class="n">employe</span><span class="o">)</span> <span class="o">{</span>
      <span class="kt">var</span> <span class="n">conges</span> <span class="o">=</span> <span class="n">employe</span><span class="o">.</span><span class="na">conges</span><span class="o">();</span>
      <span class="n">conges</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainListFormat</code> pour vérifier que le résultat affiché est toujours le même.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Congés du 15 mars 2024 au 22 mars 2024
Congés du 1 août 2024 au 21 août 2024</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Si la variable testée est du type ou est compatible avec le type du pattern alors la variable de pattern sera initialisée avec la référence de la variable testée.
Cela évite la redondance historique du type pour la déclaration de la variable et pour le cast.</p>
</div>
<div class="paragraph">
<p>La portée de la variable de pattern est définie en fonction du résultat de l&#8217;évaluation de l&#8217;expression. La variable n&#8217;est utilisable que dans le bloc où l&#8217;évaluation est <code>true</code>.</p>
</div>
<div class="listingblock">
<div class="title">Exemple</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="k">if</span> <span class="o">(!(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">Employe</span> <span class="n">employe</span><span class="o">))</span> <span class="o">{</span>
    <span class="c1">// employe n'est pas accessible</span>
  <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
    <span class="kt">var</span> <span class="n">conges</span> <span class="o">=</span> <span class="n">employe</span><span class="o">.</span><span class="na">conges</span><span class="o">();</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>La portée contient également la déclaration de la condition : cela permet d&#8217;enrichir celle-ci avec une condition supplémentaire en utilisant uniquement l&#8217;opérateur <code>&amp;&amp;</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>afficherConges()</code> de la classe <code>MainPatternMatchingInstanceof</code> pour ajouter une condition au pattern de type dans l&#8217;opérateur <code>instanceof</code> pour vérifier que la liste des congés ne soit pas vide.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afficherConges</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">Employe</span> <span class="n">employe</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">employe</span><span class="o">.</span><span class="na">conges</span><span class="o">().</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
      <span class="kt">var</span> <span class="n">conges</span> <span class="o">=</span> <span class="n">employe</span><span class="o">.</span><span class="na">conges</span><span class="o">();</span>
      <span class="n">conges</span><span class="o">.</span><span class="na">forEach</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">::</span><span class="n">println</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainListFormat</code> pour vérifier que le résultat affiché est toujours le même.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Congés du 15 mars 2024 au 22 mars 2024
Congés du 1 août 2024 au 21 août 2024</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Cela ne fonctionne pas avec l&#8217;opérateur <code>||</code> puisque la variable de pattern pourrait ne pas être initialisée.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>&nbsp;</p>
</div>
</div>
<div class="sect3">
<h4 id="record-patterns"><a class="anchor" href="#record-patterns"></a>4.3.2. Lab : les Record Patterns</h4>
<div class="paragraph">
<p>Le but est d&#8217;ajouter un nouveau pattern utilisable dans le pattern matching : le record pattern permettant de déconstruire les valeurs d&#8217;un record. Ce mécanisme permet d&#8217;affecter dans des variables les valeurs des composants du record.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JDK</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Première preview en Java 19 <a href="https://openjdk.org/jeps/405">JEP 405</a>. Standard en Java 21</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JEP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openjdk.org/jeps/440">440: Record Patterns</a></p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_le_record_pattern_avec_instanceof"><a class="anchor" href="#_le_record_pattern_avec_instanceof"></a>4.3.2.1. Le record pattern avec <code>instanceof</code></h5>
<div class="paragraph">
<p>Un record pattern est utilisable dans le pattern matching avec une instruction <code>instanceof</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="n">record</span> <span class="nf">Utilisateur</span><span class="o">(</span><span class="nc">String</span> <span class="n">prenom</span><span class="o">,</span> <span class="nc">String</span> <span class="n">nom</span><span class="o">)</span> <span class="o">{}</span>
<span class="nc">Object</span> <span class="n">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Utilisateur</span><span class="o">(</span><span class="s">"John"</span><span class="o">,</span> <span class="s">"Doe"</span><span class="o">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Il est possible d&#8217;utiliser le type pattern pour vérifier le type d&#8217;un record et l&#8217;assigner à une variable s&#8217;il correspond. On peut alors invoquer les accesseurs sur les composants du record.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">Utilisateur</span> <span class="n">utilisateur</span><span class="o">)</span> <span class="o">{</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Utilisateur : "</span> <span class="o">+</span> <span class="n">utilisateur</span><span class="o">.</span><span class="na">prenom</span><span class="o">()</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">utilisateur</span><span class="o">.</span><span class="na">nom</span><span class="o">());</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Le code peut être réécrit en utilisant un record pattern dont la syntaxe est le type du record suivi de la définition de ses composants.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nf">Utilisateur</span><span class="o">(</span><span class="nc">String</span> <span class="n">prenom</span><span class="o">,</span> <span class="nc">String</span> <span class="n">nom</span><span class="o">))</span> <span class="o">{</span>
  <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Utilisateur : "</span> <span class="o">+</span> <span class="n">prenom</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">nom</span><span class="o">);</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Dans l&#8217;exemple ci-dessus, <code>Utilisateur(String prenom, String nom)</code> est un record pattern.
Le pattern fait la correspondance avec un type qui est un record et si elle réussit alors les variables définies dans le pattern sont initialisées avec celles résultant de l&#8217;invocation des accesseurs correspondants sur l&#8217;instance du record.
Ces traitements correspondent à une forme de déconstruction du record.</p>
</div>
<div class="paragraph">
<p>Il est alors possible d&#8217;accéder directement à l&#8217;état des composants du record via des variables définies dans le pattern.
Cela réduit et simplifie le code nécessaire sans nuire à la lisibilité.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Dans la classe <code>fr.sciam.workshop.javase.recordpattern.MainRecordPattern</code>, compléter la méthode <code>afficherHeros()</code> afin d&#8217;utiliser un record pattern pour obtenir les <code>prenom</code>, <code>nom</code> et <code>univers</code> de l&#8217;instance passée en paramètre si elle est de type <code>Heros</code>. Puis afficher ces valeurs dans la console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afficherHeros</span><span class="o">(</span><span class="nc">Object</span> <span class="n">objet</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">objet</span> <span class="k">instanceof</span> <span class="nf">Heros</span><span class="o">(</span><span class="nc">String</span> <span class="n">prenom</span><span class="o">,</span> <span class="nc">String</span> <span class="n">nom</span><span class="o">,</span> <span class="nc">Univers</span> <span class="n">univers</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Héros : "</span> <span class="o">+</span> <span class="n">prenom</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">nom</span><span class="o">);</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Univers : "</span> <span class="o">+</span> <span class="n">univers</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainRecordPattern</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Afficher Héros
Héros : Bilbon Sacquet
Univers : Univers[nom=Le seigneur des anneaux, type=FANTAISIE]</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Le nom des composants n&#8217;a pas l&#8217;obligation d&#8217;être identique à celui utilisé dans la définition du record : seuls l&#8217;ordre et le type des composants doivent être respectés.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>afficherHeros()</code> pour utiliser des noms de composants différents de celui du record <code>Heros</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afficherHeros</span><span class="o">(</span><span class="nc">Object</span> <span class="n">objet</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">objet</span> <span class="k">instanceof</span> <span class="nf">Heros</span><span class="o">(</span><span class="nc">String</span> <span class="n">p</span><span class="o">,</span> <span class="nc">String</span> <span class="n">n</span><span class="o">,</span> <span class="nc">Univers</span> <span class="n">u</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Héros : "</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">n</span><span class="o">);</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Univers : "</span> <span class="o">+</span> <span class="n">u</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainRecordPattern</code> et vérifier que l&#8217;on obtient le même résultat :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Afficher Héros
Héros : Bilbon Sacquet
Univers : Univers[nom=Le seigneur des anneaux, type=FANTAISIE]</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Il est également possible d&#8217;utiliser l&#8217;inférence de type avec <code>var</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier à nouveau la méthode <code>afficherHeros()</code> pour utiliser l&#8217;inférence de type avec <code>var</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afficherHeros</span><span class="o">(</span><span class="nc">Object</span> <span class="n">objet</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">objet</span> <span class="k">instanceof</span> <span class="nf">Heros</span><span class="o">(</span><span class="kt">var</span> <span class="n">p</span><span class="o">,</span> <span class="kt">var</span> <span class="n">n</span><span class="o">,</span> <span class="kt">var</span> <span class="n">u</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Héros : "</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">n</span><span class="o">);</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Univers : "</span> <span class="o">+</span> <span class="n">u</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainRecordPattern</code> et vérifier que l&#8217;on obtient encore le même résultat :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Afficher Héros
Héros : Bilbon Sacquet
Univers : Univers[nom=Le seigneur des anneaux, type=FANTAISIE]</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Les record patterns peuvent être imbriqués pour permettre d&#8217;exploiter facilement les valeurs de records encapsulés dans d&#8217;autres records.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier à nouveau la méthode <code>afficherHeros()</code> pour déconstruire le record <code>Univers</code> encapsulé dans <code>Heros</code>. Afficher les valeurs des composants d'<code>Univers</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">afficherHeros</span><span class="o">(</span><span class="nc">Object</span> <span class="n">objet</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">objet</span> <span class="k">instanceof</span> <span class="nf">Heros</span><span class="o">(</span><span class="kt">var</span> <span class="n">p</span><span class="o">,</span> <span class="kt">var</span> <span class="n">n</span><span class="o">,</span> <span class="nc">Univers</span><span class="o">(</span><span class="nc">String</span> <span class="n">titre</span><span class="o">,</span> <span class="nc">Type</span> <span class="n">type</span><span class="o">)))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Héros : "</span> <span class="o">+</span> <span class="n">p</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">n</span><span class="o">);</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Univers : "</span> <span class="o">+</span> <span class="n">titre</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">type</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainRecordPattern</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Afficher Héros
Héros : Bilbon Sacquet
Univers : Le seigneur des anneaux FANTAISIE</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
La valeur <code>null</code> ne correspond à aucun record pattern.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="record-patterns-switch"><a class="anchor" href="#record-patterns-switch"></a>4.3.2.2. Le record pattern avec <code>switch</code></h5>
<div class="paragraph">
<p>Un record pattern est utilisable dans le pattern matching avec une instruction <code>switch</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Compléter la méthode <code>utiliserSwitch()</code> en utilisant une instruction <code>switch</code>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Dans le cas d&#8217;un objet de type <code>Heros</code>, afficher le <code>prenom</code> et le <code>nom</code>.</p>
</li>
<li>
<p>Dans le cas d&#8217;un objet de type <code>Univers</code>, afficher le <code>titre</code> et le <code>type</code>.</p>
</li>
<li>
<p>Dans les autres cas, afficher un message alternatif.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">utiliserSwitch</span><span class="o">(</span><span class="nc">Object</span> <span class="n">objet</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">objet</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nf">Heros</span><span class="o">(</span><span class="nc">String</span> <span class="n">prenom</span><span class="o">,</span> <span class="nc">String</span> <span class="n">nom</span><span class="o">,</span> <span class="nc">Univers</span> <span class="n">univers</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">prenom</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">nom</span><span class="o">);</span>
      <span class="k">case</span> <span class="nf">Univers</span><span class="o">(</span><span class="nc">String</span> <span class="n">titre</span><span class="o">,</span> <span class="nc">Type</span> <span class="n">type</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">titre</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">type</span><span class="o">);</span>
      <span class="k">case</span> <span class="kc">null</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Paramètre null"</span><span class="o">);</span>
      <span class="k">default</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Type non supporté : "</span> <span class="o">+</span> <span class="n">objet</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainRecordPattern</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Utiliser switch
Bilbon Sacquet
Le seigneur des anneaux FANTAISIE
Type non supporté : class java.lang.Integer</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_le_record_pattern_avec_les_types_génériques"><a class="anchor" href="#_le_record_pattern_avec_les_types_génériques"></a>4.3.2.3. Le record pattern avec les types génériques</h5>
<div class="paragraph">
<p>L&#8217;inférence des types d&#8217;arguments génériques dans les record patterns est supportée.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Compléter la méthode <code>utiliserGeneriques()</code> en testant le type du paramètre <code>objet</code> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>S&#8217;il est de type <code>Quete&lt;Heros&gt;</code>, afficher <code>prenom</code> et <code>nom</code> du <code>Heros</code> déconstruit.</p>
</li>
<li>
<p>S&#8217;il est de type <code>Quete&lt;String&gt;</code> afficher la chaîne de caractères.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">utiliserGeneriques</span><span class="o">(</span><span class="nc">Object</span> <span class="n">objet</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">objet</span> <span class="k">instanceof</span> <span class="nf">Quete</span><span class="o">(</span><span class="nc">Heros</span><span class="o">(</span><span class="nc">String</span> <span class="n">prenom</span><span class="o">,</span> <span class="nc">String</span> <span class="n">nom</span><span class="o">,</span> <span class="nc">Univers</span> <span class="n">univers</span><span class="o">)))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">prenom</span> <span class="o">+</span> <span class="s">" "</span> <span class="o">+</span> <span class="n">nom</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">objet</span> <span class="k">instanceof</span> <span class="nf">Quete</span><span class="o">(</span><span class="nc">String</span> <span class="n">valeur</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">valeur</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainRecordPattern</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Utiliser génériques
Bilbon Sacquet
Anneau unique</pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="pattern-matching-switch"><a class="anchor" href="#pattern-matching-switch"></a>4.3.3. Lab : le Pattern Matching for switch</h4>
<div class="paragraph">
<p>Le Pattern Matching for switch a pour but d&#8217;enrichir le langage Java en permettant l&#8217;utilisation du pattern matching dans des instructions <code>switch</code>.
Cela permet de tester si une expression correspond à un certain nombre de motifs et d&#8217;effectuer une action selon les cas rencontrés, de sorte que les requêtes complexes orientées données puissent être exprimées de manière concise et sûre.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JDK</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Première preview en Java 17 <a href="https://openjdk.org/jeps/406">JEP 406</a>. Standard en Java 21</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JEP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openjdk.org/jeps/441">441: Pattern Matching for switch</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>&nbsp;</p>
</div>
<div class="sect4">
<h5 id="_les_patterns_utilisables"><a class="anchor" href="#_les_patterns_utilisables"></a>4.3.3.1. Les patterns utilisables</h5>
<div class="paragraph">
<p>Plusieurs patterns sont utilisables dans une instruction <code>switch</code> : Type Pattern et Record Pattern.</p>
</div>
<div class="sect5">
<h6 id="_le_type_pattern"><a class="anchor" href="#_le_type_pattern"></a>4.3.3.1.1. Le Type Pattern</h6>
<div class="paragraph">
<p>Ce pattern permet de tester la correspondance de type.
La syntaxe dans un <code>case</code> est la suivante :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">case</span> <span class="nc">Type</span> <span class="nl">variable:</span>
  <span class="c1">// instruction</span>
  <span class="k">break</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>ou</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">case</span> <span class="nc">Type</span> <span class="n">variable</span> <span class="o">-&gt;</span> <span class="cm">/* instruction */</span><span class="o">;</span></code></pre>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Exécuter la classe <code>MainPatternMatchingSwitch</code> du package <code>fr.sciam.workshop.javase.pmswitch</code>.
Vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Formatter nombres
entier : 2024
long : 10000000000
flottant : 123,000000
double : 1,618034
inconnu : java.math.BigDecimal</pre>
</div>
</div>
<div class="paragraph">
<p>Toujours dans la classe <code>MainPatternMatchingSwitch</code>, refactorer la méthode <code>formatterNombre()</code> pour utiliser une instruction <code>switch</code> plutôt que la séquence <code>if</code> / <code>else if</code> / <code>else</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">formatterNombre</span><span class="o">(</span><span class="nc">Number</span> <span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>

    <span class="nc">String</span> <span class="n">resultat</span> <span class="o">=</span> <span class="k">switch</span> <span class="o">(</span><span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"entier : %d"</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
      <span class="k">case</span> <span class="nc">Long</span> <span class="n">l</span> <span class="o">-&gt;</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"long : %d"</span><span class="o">,</span> <span class="n">l</span><span class="o">);</span>
      <span class="k">case</span> <span class="nc">Float</span> <span class="n">f</span> <span class="o">-&gt;</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"flottant : %f"</span><span class="o">,</span> <span class="n">f</span><span class="o">);</span>
      <span class="k">case</span> <span class="nc">Double</span> <span class="n">d</span> <span class="o">-&gt;</span> <span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"double : %f"</span><span class="o">,</span> <span class="n">d</span><span class="o">);</span>
      <span class="k">default</span> <span class="o">-&gt;</span> <span class="s">"inconnu : "</span> <span class="o">+</span> <span class="n">nombre</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
    <span class="o">};</span>

    <span class="k">return</span> <span class="n">resultat</span><span class="o">;</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter à nouveau la classe <code>MainPatternMatchingSwitch</code> et vérifier que l&#8217;on obtient le même résultat dans la console.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Formatter nombres
entier : 2024
long : 10000000000
flottant : 123,000000
double : 1,618034
inconnu : java.math.BigDecimal</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_le_record_pattern"><a class="anchor" href="#_le_record_pattern"></a>4.3.3.1.2. Le Record Pattern</h6>
<div class="paragraph">
<p>Il est possible d&#8217;utiliser le Record Pattern dans une instruction <code>switch</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Ce point est traité dans le lab <a href="partie1.html#record-patterns">les Records Patterns</a> et plus précisément dans cette <a href="partie1.html#record-patterns-switch">mise en pratique</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_lutilisation_dun_guarded_case_label"><a class="anchor" href="#_lutilisation_dun_guarded_case_label"></a>4.3.3.2. L&#8217;utilisation d&#8217;un guarded case label</h5>
<div class="paragraph">
<p>Il est possible de combiner un pattern et une expression booléenne représentant une condition via le nouveau mot clé contextuel <code>when</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Dans la méthode <code>analyserNombre()</code>, utiliser une instruction <code>switch</code> ainsi que des "guarded case label" pour afficher dans la console le paramètre <code>nombre</code> suivi de :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Grand entier" si <code>nombre</code> est de type <code>Integer</code> et supérieur à 1000,</p>
</li>
<li>
<p>"Petit entier" si <code>nombre</code> est de type <code>Integer</code>,</p>
</li>
<li>
<p>"Grand double" si <code>nombre</code> est de type <code>Double</code> et supérieur à 1000,</p>
</li>
<li>
<p>"Petit double" si <code>nombre</code> est de type <code>Double</code>,</p>
</li>
<li>
<p>"Autre" sinon.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">analyserNombre</span><span class="o">(</span><span class="nc">Number</span> <span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="k">switch</span> <span class="o">(</span><span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="n">when</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1_000</span> <span class="o">-&gt;</span> <span class="s">"Grand entier"</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="s">"Petit entier"</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Double</span> <span class="n">d</span> <span class="n">when</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">1_000</span> <span class="o">-&gt;</span> <span class="s">"Grand double"</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Double</span> <span class="n">d</span> <span class="o">-&gt;</span> <span class="s">"Petit entier"</span><span class="o">;</span>
      <span class="k">default</span> <span class="o">-&gt;</span> <span class="s">"Autre"</span><span class="o">;</span>
    <span class="o">};</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">nombre</span> <span class="o">+</span> <span class="s">" : "</span> <span class="o">+</span> <span class="n">message</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainPatternMatchingSwitch</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Analyser nombre avec when
5 : Petit entier
10000 : Grand entier
3.141592653589793 : Petit entier
1.0E9 : Grand double</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_la_dominance_des_patterns"><a class="anchor" href="#_la_dominance_des_patterns"></a>4.3.3.3. La dominance des patterns</h5>
<div class="paragraph">
<p>L&#8217;ordre des <code>case</code> avec pattern est important.
En effet, si un <code>case</code> ne peut pas être atteint car un <code>case</code> qui le précède est plus général, alors on considère qu&#8217;il est "dominé" et l&#8217;erreur de compilation "Label is dominated by a preceding case label" est émise. Les patterns les plus restrictifs doivent donc être placés avant ceux qui le sont moins.
Par exemple, <code>case CharSequence cs</code> domine <code>case String s</code> car <code>String</code> implémente <code>CharSequence</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Dans la méthode <code>analyserObjet()</code>, utiliser une instruction <code>switch</code> avec un Type Pattern <code>Number</code> qui précède un Type Pattern <code>Integer</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">analyserObjet</span><span class="o">(</span><span class="nc">Object</span> <span class="n">objet</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">information</span> <span class="o">=</span> <span class="k">switch</span> <span class="o">(</span><span class="n">objet</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Number</span> <span class="n">nombre</span> <span class="o">-&gt;</span> <span class="s">"Nombre"</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="s">"Entier"</span><span class="o">;</span>
      <span class="k">default</span> <span class="o">-&gt;</span> <span class="s">"Autre"</span><span class="o">;</span>
    <span class="o">};</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">information</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vérifier que l&#8217;on obtient l&#8217;erreur de compilation :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Label is dominated by a preceding case label 'Number nombre'</pre>
</div>
</div>
<div class="paragraph">
<p>sur la ligne :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="s">"Entier"</span><span class="o">;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Il est donc nécessaire de respecter l&#8217;ordre des patterns par dominance.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Corriger le code de la méthode <code>analyserObjet()</code> en déplaçant le <code>case Integer i</code> afin que le code compile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">analyserObjet</span><span class="o">(</span><span class="nc">Object</span> <span class="n">objet</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">information</span> <span class="o">=</span> <span class="k">switch</span> <span class="o">(</span><span class="n">objet</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="s">"Entier"</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Number</span> <span class="n">nombre</span> <span class="o">-&gt;</span> <span class="s">"Nombre"</span><span class="o">;</span>
      <span class="k">default</span> <span class="o">-&gt;</span> <span class="s">"Autre"</span><span class="o">;</span>
    <span class="o">};</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">information</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainPatternMatchingSwitch</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Analyser objet
Autre
Entier
Nombre</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>La dominance concerne également l&#8217;utilisation des "guarded case label" avec <code>when</code>.
Un "guarded case label" peut être dominé par le même <code>case</code> pattern sans condition.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Toujours dans la méthode <code>analyserObjet()</code> ajouter un <code>case</code> pour traiter le cas spécifique d&#8217;un <code>Integer</code> négatif, après le <code>case Integer i</code> existant.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">analyserObjet</span><span class="o">(</span><span class="nc">Object</span> <span class="n">objet</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">information</span> <span class="o">=</span> <span class="k">switch</span> <span class="o">(</span><span class="n">objet</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="s">"Entier"</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="n">when</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">-&gt;</span> <span class="s">"Entier négatif"</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">Number</span> <span class="n">nombre</span> <span class="o">-&gt;</span> <span class="s">"Nombre"</span><span class="o">;</span>
      <span class="k">default</span> <span class="o">-&gt;</span> <span class="s">"Autre"</span><span class="o">;</span>
    <span class="o">};</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">information</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vérifier que l&#8217;on obtient l&#8217;erreur de compilation :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Label is dominated by a preceding case label 'Integer i'</pre>
</div>
</div>
<div class="paragraph">
<p>Déplacer ensuite ce <code>case</code> afin qu&#8217;il soit positionné avant le <code>case Integer i</code> et vérifier que le code compile à nouveau.</p>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainPatternMatchingSwitch</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Analyser objet
Autre
Entier négatif
Nombre</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_lexhaustivité_des_cas"><a class="anchor" href="#_lexhaustivité_des_cas"></a>4.3.3.4. L&#8217;exhaustivité des cas</h5>
<div class="paragraph">
<p>Le pattern matching dans une instruction <code>switch</code> impose que l&#8217;exhaustivité des cas soit couverte.
Pour cela, deux cas de figure s&#8217;offrent à nous :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>pour un type scellé, les types de la clause <code>permits</code> doivent être couverts,</p>
</li>
<li>
<p>ou bien il doit y avoir un (et un seul) cas "match all" : soit <code>default</code> soit un type pattern qui correspond de manière inconditionnelle à l&#8217;expression du sélecteur.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cela est vérifié :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>par le compilateur : une erreur est levée si l&#8217;exhaustivité n&#8217;est pas assurée,</p>
</li>
<li>
<p>au runtime par la JVM : une <code>MatchException</code> est levée. Cela peut se produire lorsqu&#8217;une classe contenant une expression ou une instruction <code>switch</code> exhaustive a été compilée, mais qu&#8217;une hiérarchie scellée utilisée a été modifiée ultérieurement et recompilée.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
La notion de classes scellées est abordée dans le lab <a href="partie1.html#classes-scellees">les classes scellées</a>
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Compléter la méthode <code>verifierExhaustivite()</code> en ajoutant une instruction <code>switch</code> qui ne couvre que le type pattern <code>Integer</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">verifierExhaustivite</span><span class="o">(</span><span class="nc">Number</span> <span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Entier"</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que l&#8217;erreur de compilation "'switch' statement does not cover all possible input values" est levée.</p>
</div>
<div class="paragraph">
<p>Ajouter le Type Pattern inconditionnel <code>Number</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">verifierExhaustivite</span><span class="o">(</span><span class="nc">Number</span> <span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Entier"</span><span class="o">);</span>
      <span class="k">case</span> <span class="nc">Number</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Nombre"</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que le code compile et exécuter la classe <code>MainPatternMatchingSwitch</code> pour vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Vérifier exhaustivité
Entier</pre>
</div>
</div>
<div class="paragraph">
<p>Ajouter le cas <code>default</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">verifierExhaustivite</span><span class="o">(</span><span class="nc">Number</span> <span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Entier"</span><span class="o">);</span>
      <span class="k">case</span> <span class="nc">Number</span> <span class="n">n</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Nombre"</span><span class="o">);</span>
      <span class="k">default</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Défaut"</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Constater que l&#8217;erreur de compilation "'switch' has both an unconditional pattern and a default label" est levée.</p>
</div>
<div class="paragraph">
<p>Enfin, supprimer le cas <code>default</code> afin que le code compile à nouveau.</p>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_la_valeur_null"><a class="anchor" href="#_la_valeur_null"></a>4.3.3.5. La valeur <code>null</code></h5>
<div class="paragraph">
<p>Historiquement, les instructions et expressions de type <code>switch</code> lèvent une <code>NullPointerException</code> si l&#8217;expression du sélecteur vaut <code>null</code>, nécessitant ainsi de tester la nullité au préalable, en dehors du <code>switch</code> pour s&#8217;en prémunir.</p>
</div>
<div class="paragraph">
<p>Il est désormais possible de définir un <code>case null</code> dont le contenu sera exécuté sans lever de <code>NullPointerException</code>.
Pour des raisons de compatibilité, s&#8217;il n&#8217;est pas présent et que l&#8217;expression du sélecteur est <code>null</code>, une <code>NullPointerException</code> sera toujours levée.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Compléter la méthode <code>utiliserSwitchAvecNull()</code> afin d&#8217;afficher en fonction du paramètre <code>nombre</code> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"Entier" s&#8217;il est de type <code>Integer</code></p>
</li>
<li>
<p>"null" s&#8217;il est <code>null</code></p>
</li>
<li>
<p>"défaut" sinon</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">utiliserSwitchAvecNull</span><span class="o">(</span><span class="nc">Number</span> <span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Entier"</span><span class="o">);</span>
      <span class="k">case</span> <span class="kc">null</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"null"</span><span class="o">);</span>
      <span class="k">default</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"défaut"</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainPatternMatchingSwitch</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Utiliser switch avec null
null
Entier</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Il n&#8217;est pas possible de combiner <code>null</code> avec autre chose que <code>default</code>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier à nouveau la méthode <code>utiliserSwitchAvecNull()</code> pour tenter de combiner le Type Pattern <code>Double</code> avec <code>null</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">utiliserSwitchAvecNull</span><span class="o">(</span><span class="nc">Number</span> <span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Entier"</span><span class="o">);</span>
      <span class="k">case</span> <span class="nc">Double</span> <span class="n">d</span><span class="o">,</span> <span class="kc">null</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"null"</span><span class="o">);</span>
      <span class="k">default</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"défaut"</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Vérifier que l&#8217;on obtient l&#8217;erreur de compilation suivante :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Invalid case label combination: 'null' can only be used as a single case label or paired only with 'default'</pre>
</div>
</div>
<div class="paragraph">
<p>Supprimer la ligne qui est en erreur et combiner les cas <code>null</code> et <code>default</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">utiliserSwitchAvecNull</span><span class="o">(</span><span class="nc">Number</span> <span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span> <span class="o">(</span><span class="n">nombre</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Integer</span> <span class="n">i</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Entier"</span><span class="o">);</span>
      <span class="k">case</span> <span class="kc">null</span><span class="o">,</span> <span class="k">default</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"null ou défaut"</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainPatternMatchingSwitch</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Utiliser switch avec null
null ou défaut
Entier</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_les_constantes_dénumération_qualifiées"><a class="anchor" href="#_les_constantes_dénumération_qualifiées"></a>4.3.3.6. Les constantes d&#8217;énumération qualifiées</h5>
<div class="paragraph">
<p>Il est désormais possible d&#8217;utiliser des constantes d&#8217;énumérations qualifiées, ceci afin d&#8217;éviter de devoir recourir à un "guarded case label".
Cela permet au sein d&#8217;un même <code>switch</code> de tester l&#8217;expression du sélecteur avec différents types d&#8217;énumérations.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Consulter l&#8217;interface <code>Vehicule</code>, les <code>enum</code> <code>VehiculeAerien</code> et <code>VehiculeTerrestre</code>, et la classe <code>VehiculePrototype</code>.</p>
</div>
<div class="paragraph">
<p>Compléter la méthode <code>analyserVehicule()</code> afin de tester si le paramètre <code>vehicule</code> correspond à :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>VehiculeAerien.AVION</code></p>
</li>
<li>
<p><code>VehiculeAerien.MONGOLFIERE</code></p>
</li>
<li>
<p><code>VehiculeTerrestre.VOITURE</code></p>
</li>
<li>
<p><code>VehiculeTerrestre.TRAIN</code></p>
</li>
<li>
<p><code>VehiculePrototype</code></p>
</li>
<li>
<p>autre chose</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Afficher pour chaque cas un message unique.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">analyserVehicule</span><span class="o">(</span><span class="nc">Vehicule</span> <span class="n">vehicule</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="n">message</span> <span class="o">=</span> <span class="k">switch</span> <span class="o">(</span><span class="n">vehicule</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">VehiculeAerien</span><span class="o">.</span><span class="na">AVION</span> <span class="o">-&gt;</span> <span class="s">"Avion"</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">VehiculeAerien</span><span class="o">.</span><span class="na">MONGOLFIERE</span> <span class="o">-&gt;</span> <span class="s">"Montgolfière"</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">VehiculeTerrestre</span><span class="o">.</span><span class="na">VOITURE</span> <span class="o">-&gt;</span> <span class="s">"Voiture"</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">VehiculeTerrestre</span><span class="o">.</span><span class="na">TRAIN</span> <span class="o">-&gt;</span> <span class="s">"Train"</span><span class="o">;</span>
      <span class="k">case</span> <span class="nc">VehiculePrototype</span> <span class="n">vp</span> <span class="o">-&gt;</span> <span class="s">"Véhicule"</span><span class="o">;</span>
      <span class="k">default</span> <span class="o">-&gt;</span> <span class="s">"Autre véhicule"</span><span class="o">;</span>
    <span class="o">};</span>

    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainPatternMatchingSwitch</code> et vérifier que l&#8217;on obtient dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Analyser véhicule
Avion
Montgolfière
Voiture
Train
Véhicule
Autre véhicule</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_les_autres_évolutions_syntaxiques"><a class="anchor" href="#_les_autres_évolutions_syntaxiques"></a>4.4. Les autres évolutions syntaxiques</h3>
<div class="paragraph">
<p>Plusieurs évolutions de la syntaxe sont relatives à diverses fonctionnalités qui simplifient certaines portions de code.</p>
</div>
<div class="sect3">
<h4 id="unnamed-variables-patterns"><a class="anchor" href="#unnamed-variables-patterns"></a>4.4.1. Lab : les Unnamed Variables &amp; Patterns</h4>
<div class="paragraph">
<p>Il est parfois nécessaire de définir des variables locales ou des patterns qui ne sont pas utilisés. Il arrive aussi parfois que certains patterns imbriqués dans un record pattern ne soient pas utilisés. Ces situations étaient ennuyeuses jusqu&#8217;à Java 21 car il fallait définir ces éléments en leur fournissant un nom qui idéalement exprime leur inutilité.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br></p>
</div>
<div class="paragraph">
<p>Observer et exécuter la classe <code>fr.sciam.workshop.javase.unnamed.MainUnnamed</code> pour vérifier qu&#8217;elle affiche dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Variable sans nom
traiter
Fermeture de la ressource

Variable de pattern sans nom
Employe : Nom1

Variable de pattern sans nom avec pattern matching
fr.sciam.workshop.javase.unnamed.Cercle@1b701da1

Pattern sans nom
Employe : Nom1</pre>
</div>
</div>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JDK</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Première preview en Java 21 <a href="https://openjdk.org/jeps/443">JEP 443</a>. Standard en Java 22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JEP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openjdk.org/jeps/456">456: Unnamed Variables &amp; Patterns</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>A partir de Java 22, le langage Java est enrichi d&#8217;une syntaxe pour définir des variables ainsi que des motifs sans nom (Unnamed), qui peuvent être utilisés lorsque des déclarations de variables ou de patterns imbriqués qui peuvent être nécessaires mais ne sont jamais utilisés dans le code.</p>
</div>
<div class="paragraph">
<p>La mise en œuvre syntaxique se fait en utilisant le 51<sup>eme</sup> mot clé réservé de Java, introduit en Java 9 : l&#8217;unique caractère <code>_</code> (underscore).</p>
</div>
<div class="paragraph">
<p>Trois cas d&#8217;utilisation sont proposés :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unnamed variable : pour une variable qui peut être initialisée mais non utilisée</p>
</li>
<li>
<p>Unnamed pattern variable : pour une variable de pattern utilisable avec tous types de patterns</p>
</li>
<li>
<p>Unnamed pattern : un pattern inconditionnel, qui ne correspond à rien, utilisable uniquement dans un pattern imbriqué à la place d&#8217;un type ou record pattern</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_les_variables_sans_nom_unnamed_variable"><a class="anchor" href="#_les_variables_sans_nom_unnamed_variable"></a>4.4.1.1. Les variables sans nom (Unnamed variable)</h5>
<div class="paragraph">
<p>Une variable sans nom est une variable qui peut être initialisée mais non utilisée dans :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Une variable locale dans un bloc</p>
</li>
<li>
<p>Une ressource dans un try-with-resources</p>
</li>
<li>
<p>L&#8217;en-tête d&#8217;une boucle <code>for</code> et <code>for</code> améliorée</p>
</li>
<li>
<p>Une exception d&#8217;un bloc <code>catch</code></p>
</li>
<li>
<p>Un paramètre formel d&#8217;une expression Lambda</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Comme elles ne peuvent pas être utilisées après leur déclaration, elles sont utilisables plusieurs fois dans la même portée.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>utiliserVariableSansNom()</code> de la classe <code>MainUnnamed</code> pour remplacer les variables <code>u</code>, <code>r</code>, <code>a</code>, <code>b</code>, et <code>t</code> par des variables sans nom  :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">utiliserVariableSansNom</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">(</span><span class="kt">var</span> <span class="n">_</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UneRessource</span><span class="o">())</span> <span class="o">{</span>
      <span class="kt">var</span> <span class="n">_</span> <span class="o">=</span> <span class="n">traiter</span><span class="o">((</span><span class="n">_</span><span class="o">,</span> <span class="n">_</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"traiter"</span><span class="o">),</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>  <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">_</span><span class="o">)</span> <span class="o">{</span> <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainUnnamed</code> pour vérifier que la méthode <code>utiliserVariableSansNom()</code> affiche toujours la même chose</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Variable sans nom
traiter
Fermeture de la ressource</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_les_variables_de_pattern_sans_nom_unnamed_pattern_variable"><a class="anchor" href="#_les_variables_de_pattern_sans_nom_unnamed_pattern_variable"></a>4.4.1.2. Les variables de pattern sans nom (Unnamed pattern variable)</h5>
<div class="paragraph">
<p>Une variable de pattern sans nom est utilisable avec tous types de patterns</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
cette section utilise un record pattern. Le lab <a href="partie1.html#record-patterns">les Record Patterns</a> détaille cette fonctionnalité.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>utiliserVariablePatternSansNom()</code> de la classe <code>MainUnnamed</code> pour remplacer les variables <code>prenom</code> et <code>grade</code> par des variables de pattern sans nom  :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">utiliserVariablePatternSansNom</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nf">Employe</span><span class="o">(</span><span class="kt">var</span> <span class="n">nom</span><span class="o">,</span> <span class="kt">var</span> <span class="n">_</span> <span class="o">,</span> <span class="kt">var</span> <span class="n">_</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Employe : "</span> <span class="o">+</span> <span class="n">nom</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainUnnamed</code> pour vérifier que la méthode <code>utiliserVariablePatternSansNom()</code> affiche toujours la même chose</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Variable de pattern sans nom
Employe : Nom1</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_lutilisation_de_variables_de_pattern_sans_nom_avec_le_pattern_matching"><a class="anchor" href="#_lutilisation_de_variables_de_pattern_sans_nom_avec_le_pattern_matching"></a>4.4.1.3. L&#8217;utilisation de variables de pattern sans nom avec le pattern matching</h5>
<div class="paragraph">
<p>Les variables de pattern sans nom sont particulièrement utiles dans des <code>switch</code> avec des patterns sur des types scellés.</p>
</div>
<div class="paragraph">
<p>Il n&#8217;est pas possible d&#8217;avoir plusieurs patterns nommés dans une même clause <code>case</code>. Si plusieurs patterns ne sont pas utiles, il faut les définir chacun dans un <code>case</code> avec un bloc de code vide.</p>
</div>
<div class="paragraph">
<p>Il est possible d&#8217;utiliser des variables de pattern sans nom dans plusieurs types patterns d&#8217;un même <code>case</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
cette section utilise des classes scellées. Le lab <a href="partie1.html#classes-scellees">les classes scellées</a> détaille cette fonctionnalité.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>utiliserVariablePatternSansNomAvecPatternMatching()</code> de la classe <code>MainUnnamed</code> pour remplacer les cases avec des types pattern sur <code>Carre</code> et <code>Rectangle</code> par un seul <code>case</code> utilisant des variables de pattern sans nom  :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">utiliserVariablePatternSansNomAvecPatternMatching</span><span class="o">(</span><span class="nc">Forme</span> <span class="n">forme</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">switch</span><span class="o">(</span><span class="n">forme</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">case</span> <span class="nc">Cercle</span> <span class="n">c</span> <span class="o">-&gt;</span> <span class="n">afficher</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
      <span class="k">case</span> <span class="nc">Carre</span> <span class="n">_</span> <span class="o">,</span> <span class="nc">Rectangle</span> <span class="n">_</span> <span class="o">-&gt;</span> <span class="o">{}</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainUnnamed</code> pour vérifier que la méthode <code>utiliserVariablePatternSansNomAvecPatternMatching()</code> affiche toujours la même chose</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Variable de pattern sans nom avec pattern matching
fr.sciam.workshop.javase.unnamed.Cercle@1b701da1</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Si un nouveau type est ajouté à la hiérarchie scellée, alors le compilateur émettra une erreur à la compilation du code contenant le <code>switch</code> et la JVM lèvera une exception puisque l&#8217;exhaustivité des cas n&#8217;est plus assurée.</p>
</div>
</div>
<div class="sect4">
<h5 id="_les_patterns_sans_nom_unnamed_pattern"><a class="anchor" href="#_les_patterns_sans_nom_unnamed_pattern"></a>4.4.1.4. Les patterns sans nom (Unnamed pattern)</h5>
<div class="paragraph">
<p>Un pattern sans nom est un pattern inconditionnel, qui ne correspond à rien, utilisable uniquement dans un pattern imbriqué à la place d&#8217;un type ou d&#8217;un record pattern.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la méthode <code>utiliserPatternSansNom()</code> de la classe <code>MainUnnamed</code> pour remplacer les variables <code>prenom</code> et <code>grade</code> par des patterns sans nom  :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">utiliserPatternSansNom</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="k">instanceof</span> <span class="nf">Employe</span><span class="o">(</span><span class="kt">var</span> <span class="n">nom</span><span class="o">,</span> <span class="n">_</span> <span class="o">,</span> <span class="n">_</span><span class="o">))</span> <span class="o">{</span>
      <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Employe : "</span> <span class="o">+</span> <span class="n">nom</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainUnnamed</code> pour vérifier que la méthode <code>utiliserVariablePatternSansNom()</code> affiche toujours la même chose</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Pattern sans nom
Employe : Nom1</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>&nbsp;</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lab_les_statements_before_super"><a class="anchor" href="#_lab_les_statements_before_super"></a>4.4.2. Lab : les Statements Before Super(&#8230;&#8203;)</h4>
<div class="paragraph">
<p>Historiquement, afin de garantir l&#8217;initialisation des champs, la première instruction d&#8217;un constructeur doit obligatoirement être l&#8217;invocation d&#8217;un constructeur de la classe ou super-classe, explicitement en invoquant <code>this()</code> ou <code>super()</code> avec éventuellement des paramètres selon la surcharge du constructeur invoquée ou à défaut implicitement par le compilateur. Dans ce dernier cas, c&#8217;est le constructeur par défaut (sans paramètre) qui est invoqué.</p>
</div>
<div class="paragraph">
<p>C&#8217;est parfois contraignant, notamment car cela impose d&#8217;invoquer un autre constructeur, par exemple avant de pouvoir faire des contrôles sur les valeurs.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Consulter la classe <code>fr.sciam.workshop.javase.beforesuper.EntierPositif</code> et particulièrement son constructeur.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">class</span> <span class="nc">EntierPositif</span> <span class="kd">extends</span> <span class="nc">Entier</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="nf">EntierPositif</span><span class="o">(</span><span class="kt">int</span> <span class="n">valeur</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">valeur</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">valeur</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">(</span><span class="s">"La valeur est negative"</span><span class="o">);</span> <i class="conum" data-value="1"></i><b>(1)</b>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Avant Java 22, le contrôle de la valeur doit se faire obligatoirement après l&#8217;invocation du super constructeur.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>fr.sciam.workshop.javase.beforesuper.MainBeforeSuper</code> et vérifier qu&#8217;elle affiche dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Invocation constructeur Entier
java.lang.IllegalArgumentException: La valeur est negative
	at fr.sciam.workshop.javase.beforesuper.EntierPositif.&lt;init&gt;(MainBeforeSuper.java:17)
	at fr.sciam.workshop.javase.beforesuper.MainBeforeSuper.main(MainBeforeSuper.java:6)</pre>
</div>
</div>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JDK</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Première preview en Java 22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JEP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openjdk.org/jeps/447">447: Statements before super(&#8230;&#8203;) (Preview)</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
En Java 22, cette fonctionnalité est <a href="deroulement.html#preview">en preview</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A partir de Java 22, il est possible d&#8217;avoir dans les constructeurs des traitements qui ne font pas référence à l&#8217;instance avant l&#8217;invocation explicite du constructeur dans une portion de texte dénommée prologue dans les spécifications.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la classe <code>EntierPositif</code> pour effectuer le contrôle de la valeur avant l&#8217;invocation du super constructeur.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">class</span> <span class="nc">EntierPositif</span> <span class="kd">extends</span> <span class="nc">Entier</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="nf">EntierPositif</span><span class="o">(</span><span class="kt">int</span> <span class="n">valeur</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">valeur</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">(</span><span class="s">"La valeur est negative"</span><span class="o">);</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">valeur</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>MainBeforeSuper</code> et vérifier qu&#8217;elle affiche dans la console :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>java.lang.IllegalArgumentException: La valeur est negative
	at fr.sciam.workshop.javase.beforesuper.EntierPositif.&lt;init&gt;(MainBeforeSuper.java:16)
	at fr.sciam.workshop.javase.beforesuper.MainBeforeSuper.main(MainBeforeSuper.java:6)</pre>
</div>
</div>
<div class="paragraph">
<p>Constater que le super constructeur n&#8217;est plus invoqué.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>Il n&#8217;est évidemment pas possible d&#8217;utiliser de références à un membre de l&#8217;instance ou de sa super classe : il est donc impossible d&#8217;utiliser <code>this.xxx</code> ou <code>super.xxx</code> explicitement ou implicitement.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier la classe <code>EntierPositif</code> pour afficher la propriété héritée <code>valeur</code> avant l&#8217;invocation du super constructeur.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">class</span> <span class="nc">EntierPositif</span> <span class="kd">extends</span> <span class="nc">Entier</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="nf">EntierPositif</span><span class="o">(</span><span class="kt">int</span> <span class="n">valeur</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">valeur</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">valeur</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nc">IllegalArgumentException</span><span class="o">(</span><span class="s">"La valeur est negative"</span><span class="o">);</span>
    <span class="kd">super</span><span class="o">(</span><span class="n">valeur</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Compiler la classe <code>MainBeforeSuper</code> et constater qu&#8217;une erreur est émise :</p>
</div>
<div class="listingblock">
<div class="content">
<pre>MainBeforeSuper.java:16: error: cannot reference this before supertype constructor has been called
    System.out.println(this.valeur);
                       ^</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>&nbsp;</p>
</div>
</div>
<div class="sect3">
<h4 id="implicit-classes-main-method"><a class="anchor" href="#implicit-classes-main-method"></a>4.4.3. Lab : les Implicitly Declared Classes and Instance Main Methods</h4>
<div class="paragraph">
<p>Historiquement, un simple "Hello World" est plutôt compliqué en Java pour les débutants car il met en œuvre différents concepts de visibilité, de classe, de <code>static</code>, de tableau de chaîne de caractères.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Consulter la classe <code>HelloWorld.java</code> dans le sous-répertoire <code>src\main\java</code> du workspace</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span> <span class="o">{</span>
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello World"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Compiler la classe <code>HelloWorld.java</code> dans le sous-répertoire <code>src\main\java</code> du workspace avec la commande :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">javac HelloWorld.java</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">Résultat d&#8217;exécution</div>
<div class="content">
<pre>C:\workshop\src\main\java>javac HelloWorld.java

C:\workshop\src\main\java></pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>HelloWorld</code> dans le sous-répertoire <code>src\main\java</code> du workspace avec la commande :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">java HelloWorld</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">Résultat d&#8217;exécution</div>
<div class="content">
<pre>C:\workshop\src\main\java>java HelloWorld
Hello World</pre>
</div>
</div>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JDK</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Première preview en Java 21 <a href="https://openjdk.org/jeps/445">JEP 445</a>. Second Preview en Java 22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JEP</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openjdk.org/jeps/463">463: Implicitly Declared Classes and Instance Main Methods (Second Preview)</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
En Java 22, cette fonctionnalité est <a href="deroulement.html#preview">en preview</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Le but est de faire évoluer le langage pour simplifier les programmes simples et faciliter l&#8217;apprentissage du langage Java par les débutants.</p>
</div>
<div class="paragraph">
<p>Deux évolutions sont proposées dans un fichier source unique.</p>
</div>
<div class="paragraph">
<p>La méthode <code>main()</code> peut être une méthode d&#8217;instance avec ou sans tableau de chaînes de caractères en paramètre. Ainsi quatre formes sont possibles pour la méthode <code>main()</code> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>statique ou d&#8217;instance</p>
</li>
<li>
<p>avec ou sans paramètre selon les besoins</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La visibilité de la méthode <code>main()</code> peut être <code>public</code>, <code>protected</code> ou par défaut (package-private).</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier le fichier <code>HelloWorld.java</code> pour que la méthode <code>main()</code> soit une méthode d&#8217;instance avec la visibilité par défaut.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello World"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Compiler et exécuter la classe <code>HelloWorld.java</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plain">C:\workshop\src\main\java>javac HelloWorld.java

C:\workshop\src\main\java>java HelloWorld
Error: Main method not found in class HelloWorld, please define the main method as:
   public static void main(String[] args)
or a JavaFX application class must extend javafx.application.Application</code></pre>
</div>
</div>
<div class="paragraph">
<p>La classe ne s&#8217;exécute pas car la fonctionnalité est en <code>preview</code>. Ajouter les options requises pour compiler et exécuter du code qui utilise des fonctionnalités en <code>preview</code>.</p>
</div>
<div class="paragraph">
<p>Compiler la classe <code>HelloWorld.java</code> dans le sous-répertoire <code>src\main\java</code> du workspace avec la commande :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">javac <span class="nt">--enable-preview</span> <span class="nt">--source</span> 22 HelloWorld.java</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">Résultat d&#8217;exécution</div>
<div class="content">
<pre>C:\workshop\src\main\java>javac --enable-preview --source 22 HelloWorld.java</pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>HelloWorld</code> dans le sous-répertoire <code>src\main\java</code> du workspace avec la commande :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">java <span class="nt">--enable-preview</span> HelloWorld</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">Résultat d&#8217;exécution</div>
<div class="content">
<pre>C:\workshop\src\main\java>java --enable-preview HelloWorld
Hello World</pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>Le tableau de chaînes de caractères de la méthode <code>main()</code> contenant les arguments passés à l&#8217;application sont optionnels.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier <code>HelloWorld.java</code> pour que la méthode <code>main()</code> soit sans paramètre.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorld</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">main</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello World"</span><span class="o">);</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Compiler et exécuter la classe <code>HelloWorld.java</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plain">C:\workshop\src\main\java>javac --enable-preview --source 22 HelloWorld.java

C:\workshop\src\main\java>java --enable-preview HelloWorld
Hello World</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph">
<p>La sélection, par la JVM, de la méthode <code>main()</code> à utiliser se fait en 2 étapes :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Invocation d&#8217;une méthode candidate avec un paramètre <code>String[]</code>, si elle existe</p>
</li>
<li>
<p>Sinon invocation d&#8217;une méthode candidate sans paramètre si elle existe</p>
</li>
<li>
<p>Sinon une erreur est émise</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Il n&#8217;y pas d&#8217;ambiguïté car une méthode statique et d&#8217;instance ne peuvent pas avoir la même signature.</p>
</div>
<div class="paragraph">
<p>Il n&#8217;est plus obligatoire de définir explicitement une classe : dans ce cas, une classe implicite sera définie par le compilateur (implicit declared class) dans le package par défaut.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br>
Modifier <code>HelloWorld.java</code> pour retirer la classe et ne laisser que la méthode <code>main()</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="java">  <span class="kt">void</span> <span class="nf">main</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello World"</span><span class="o">);</span>
  <span class="o">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Compiler et exécuter la classe <code>HelloWorld.java</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="plain">C:\workshop\src\main\java>javac --enable-preview --source 22 HelloWorld.java
Note: HelloWorld.java uses preview features of Java SE 22.
Note: Recompile with -Xlint:preview for details.

C:\workshop\src\main\java>java --enable-preview HelloWorld
Hello World</code></pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
le nom du fichier est libre tant que qu&#8217;il est un identifiant Java valide.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Un constructeur par défaut sera créé par le compilateur mais il n&#8217;est pas possible de définir explicitement un constructeur puisque le nom de la classe n&#8217;est pas connu.</p>
</div>
<div class="paragraph">
<p>Comme le nom de la classe n&#8217;est pas connu, il n&#8217;est pas possible d&#8217;utiliser de référence de méthodes sur ses méthodes statiques.</p>
</div>
<div class="paragraph">
<p>Depuis Java 11, il est aussi possible d&#8217;utiliser directement la JVM pour exécuter un unique fichier source Java qui sera compilé à la volée au lancement de la JVM.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><span class="icon blue"><i class="fa fa-keyboard-o fa-2x"></i></span><br></p>
</div>
<div class="paragraph">
<p>Supprimer le fichier <code>HelloWorld.class</code> avec la commande :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">del HelloWorld.class</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">Résultat d&#8217;exécution</div>
<div class="content">
<pre>C:\workshop\src\main\java>del HelloWorld.class</pre>
</div>
</div>
<div class="paragraph">
<p>Exécuter la classe <code>HelloWorld.java</code> directement par la JVM avec les options requises pour compiler et exécuter du code qui utilise des fonctionnalités en <code>preview</code> avec la commande :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="shell">java <span class="nt">--enable-preview</span> <span class="nt">--source</span> 22 HelloWorld.java</code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">Résultat d&#8217;exécution</div>
<div class="content">
<pre>C:\workshop\src\main\java>java --enable-preview --source 22 HelloWorld.java
Hello World</pre>
</div>
</div>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Il n&#8217;est pas possible d&#8217;avoir de Javadoc sur une classe implicite.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>&nbsp;</p>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← : <a href="deroulement.html">Le déroulement du workshop</a> | ↑ : <a href="index.html">Workshop Java SE en 2024</a> | : <a href="partie2.html">Partie 2 : les évolutions dans les API</a> →</p>
</div>
</div>
<div id="footer">
    <p class="footer-text" >© 2024 Clément de Tastes et J.M. Doudoux | Licence Creative Commons BY-NC-ND 4.0 DEED <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.fr" target="_blank"><img src="images/by-nc-nd.png" width="100"></a> </p>
</div>
</body>
</html>